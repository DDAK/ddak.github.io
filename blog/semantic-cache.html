<!DOCTYPE html><html lang="en"><head><meta name="google-adsense-account" content="ca-pub-1570360577499483"/><link rel="shortcut icon" href="/favicon.ico"/><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/><link rel="android-chrome-icon" sizes="512x512" href="/android-chrome-512x152.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/><meta charSet="utf-8" class="jsx-ebf8a252ba2b54a2"/><meta name="viewport" content="width=device-width, initial-scale=1" class="jsx-ebf8a252ba2b54a2"/><meta name="description" content="A deep dive into building a distributed semantic cache using Apache Arrow Flight, HNSW indexing, and consistent hashing - enabling AI agents to retrieve information by meaning, not just exact keys." class="jsx-ebf8a252ba2b54a2"/><meta name="author" content="Dawood Khan" class="jsx-ebf8a252ba2b54a2"/><meta name="keywords" content="semantic cache,agentic AI,distributed systems,vector search,HNSW,Apache Arrow,Arrow Flight,consistent hashing" class="jsx-ebf8a252ba2b54a2"/><meta property="og:title" content="Semantic Cache: Supercharging Agentic AI with Distributed Semantic Search - Dawood Khan" class="jsx-ebf8a252ba2b54a2"/><meta property="og:description" content="A deep dive into building a distributed semantic cache using Apache Arrow Flight, HNSW indexing, and consistent hashing - enabling AI agents to retrieve information by meaning, not just exact keys." class="jsx-ebf8a252ba2b54a2"/><meta property="og:url" content="https://ddak.github.io/blog/semantic-cache" class="jsx-ebf8a252ba2b54a2"/><meta property="og:image" content="https://ddak.github.io/images/semantic-cache/semantic-cache.jpeg" class="jsx-ebf8a252ba2b54a2"/><meta property="og:type" content="article" class="jsx-ebf8a252ba2b54a2"/><meta property="og:article:publisher" content="https://ddak.github.io/" class="jsx-ebf8a252ba2b54a2"/><meta property="og:site_name" content="Dawood Khan" class="jsx-ebf8a252ba2b54a2"/><meta name="twitter:card" content="summary_large_image" class="jsx-ebf8a252ba2b54a2"/><meta name="twitter:title" content="Semantic Cache: Supercharging Agentic AI with Distributed Semantic Search - Dawood Khan" class="jsx-ebf8a252ba2b54a2"/><meta name="twitter:description" content="A deep dive into building a distributed semantic cache using Apache Arrow Flight, HNSW indexing, and consistent hashing - enabling AI agents to retrieve information by meaning, not just exact keys." class="jsx-ebf8a252ba2b54a2"/><meta name="twitter:url" content="https://ddak.github.io/blog/semantic-cache" class="jsx-ebf8a252ba2b54a2"/><meta name="twitter:site" content="@ddak_1980" class="jsx-ebf8a252ba2b54a2"/><meta name="twitter:image" content="https://ddak.github.io/images/semantic-cache/semantic-cache.jpeg" class="jsx-ebf8a252ba2b54a2"/><meta name="twitter:creator" content="@ddak_1980" class="jsx-ebf8a252ba2b54a2"/><link rel="icon" href="/images/dawood.png?" class="jsx-ebf8a252ba2b54a2"/><link rel="canonical" href="https://ddak.github.io/blog/semantic-cache" class="jsx-ebf8a252ba2b54a2"/><title class="jsx-ebf8a252ba2b54a2">Semantic Cache: Supercharging Agentic AI with Distributed Semantic Search - Dawood Khan</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css" integrity="sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn" crossorigin="anonymous" class="jsx-ebf8a252ba2b54a2"/><meta name="next-head-count" content="30"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><link rel="preload" href="/_next/static/css/67a638c44ef5d13e.css" as="style"/><link rel="stylesheet" href="/_next/static/css/67a638c44ef5d13e.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-ee7e63bc15b31913.js" defer=""></script><script src="/_next/static/chunks/framework-64ad27b21261a9ce.js" defer=""></script><script src="/_next/static/chunks/main-9f5a69a7cc5beb93.js" defer=""></script><script src="/_next/static/chunks/pages/_app-bf88b5f8ab0a2739.js" defer=""></script><script src="/_next/static/chunks/d9067523-b5dcc64510b0bbdc.js" defer=""></script><script src="/_next/static/chunks/767-b8bd17e0d5ac3bce.js" defer=""></script><script src="/_next/static/chunks/232-bba1b57360807c0d.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bid%5D-40afd36b0efd40eb.js" defer=""></script><script src="/_next/static/07lGeU8PBalbsg9jjiHrK/_buildManifest.js" defer=""></script><script src="/_next/static/07lGeU8PBalbsg9jjiHrK/_ssgManifest.js" defer=""></script><style id="__jsx-eda6f87527bcedd1">.tags-container.jsx-eda6f87527bcedd1{padding:16px 5vw;background:rgba(18,18,26,.95);border-bottom:1px solid rgba(0,240,255,.1)}.tags.jsx-eda6f87527bcedd1{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;gap:10px}.tags.jsx-eda6f87527bcedd1 .tag-link{font-family:"Share Tech Mono",monospace;font-size:.85rem;color:#39ff14;padding:6px 12px;text-decoration:none;background:rgba(57,255,20,.08);border:1px solid rgba(57,255,20,.2);-webkit-border-radius:4px;-moz-border-radius:4px;border-radius:4px;-webkit-transition:all.3s ease;-moz-transition:all.3s ease;-o-transition:all.3s ease;transition:all.3s ease}.tags.jsx-eda6f87527bcedd1 .tag-link:hover{color:#00f0ff;background:rgba(0,240,255,.1);border-color:rgba(0,240,255,.3);-webkit-transform:translatey(-1px);-moz-transform:translatey(-1px);-ms-transform:translatey(-1px);-o-transform:translatey(-1px);transform:translatey(-1px)}.tags.jsx-eda6f87527bcedd1 .tag-link:active{color:#f0a;border-color:rgba(255,0,170,.3)}</style><style id="__jsx-6218e1577aed4ed2">.header.jsx-6218e1577aed4ed2{position:-webkit-sticky;position:sticky;top:0;z-index:100;backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px)}.header-container.jsx-6218e1577aed4ed2{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-moz-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;padding:16px 5vw;background:rgba(10,10,15,.9);border-bottom:1px solid rgba(0,240,255,.15)}.header-left.jsx-6218e1577aed4ed2{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center}.header-left.jsx-6218e1577aed4ed2 .logo-link{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;gap:12px;text-decoration:none}.header-left.jsx-6218e1577aed4ed2 .logo-img{-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;border:2px solid#00f0ff;-webkit-box-shadow:0 0 15px rgba(0,240,255,.4);-moz-box-shadow:0 0 15px rgba(0,240,255,.4);box-shadow:0 0 15px rgba(0,240,255,.4);-webkit-transition:all.3s ease;-moz-transition:all.3s ease;-o-transition:all.3s ease;transition:all.3s ease}.header-left.jsx-6218e1577aed4ed2 .logo-img:hover{-webkit-box-shadow:0 0 25px rgba(0,240,255,.6);-moz-box-shadow:0 0 25px rgba(0,240,255,.6);box-shadow:0 0 25px rgba(0,240,255,.6)}.header-left.jsx-6218e1577aed4ed2 .site-name{font-family:"Share Tech Mono",monospace;font-size:1.4rem;font-weight:600;color:#e4e4e7;letter-spacing:.5px;-webkit-transition:color.3s ease;-moz-transition:color.3s ease;-o-transition:color.3s ease;transition:color.3s ease}.header-left.jsx-6218e1577aed4ed2 .site-name:hover{color:#00f0ff}.header-right.jsx-6218e1577aed4ed2{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;gap:8px}.header-right.jsx-6218e1577aed4ed2 .nav-link{font-family:"Share Tech Mono",monospace;font-size:.95rem;text-decoration:none;color:#a1a1aa;padding:8px 16px;border:1px solid transparent;-webkit-border-radius:4px;-moz-border-radius:4px;border-radius:4px;-webkit-transition:all.3s ease;-moz-transition:all.3s ease;-o-transition:all.3s ease;transition:all.3s ease;position:relative}.header-right.jsx-6218e1577aed4ed2 .nav-link:hover{color:#00f0ff;border-color:rgba(0,240,255,.3);background:rgba(0,240,255,.05)}.header-right.jsx-6218e1577aed4ed2 .nav-link:active{color:#39ff14}.header-description.jsx-6218e1577aed4ed2{padding:20px 5vw;background:-webkit-linear-gradient(315deg,rgba(18,18,26,.95)0%,rgba(26,26,36,.95)100%);background:-moz-linear-gradient(315deg,rgba(18,18,26,.95)0%,rgba(26,26,36,.95)100%);background:-o-linear-gradient(315deg,rgba(18,18,26,.95)0%,rgba(26,26,36,.95)100%);background:linear-gradient(135deg,rgba(18,18,26,.95)0%,rgba(26,26,36,.95)100%);border-bottom:1px solid rgba(0,240,255,.1)}.header-description.jsx-6218e1577aed4ed2 p.jsx-6218e1577aed4ed2{font-family:"Source Sans Pro",sans-serif;font-size:1rem;color:#a1a1aa;text-align:center;margin:0;line-height:1.6}@media screen and (max-width:640px){.header-container.jsx-6218e1577aed4ed2{padding:12px 4vw}.header-left.jsx-6218e1577aed4ed2 .site-name{display:none}.header-right.jsx-6218e1577aed4ed2 .nav-link{padding:8px 12px;font-size:.9rem}.header-description.jsx-6218e1577aed4ed2{padding:16px 4vw}.header-description.jsx-6218e1577aed4ed2 p.jsx-6218e1577aed4ed2{font-size:.9rem}}</style><style id="__jsx-870580ea71b30c5e">.img-text.jsx-870580ea71b30c5e{display:block;text-align:center;font-family:"Source Sans Pro",sans-serif;font-size:-webkit-calc(.8rem + .1vw);font-size:-moz-calc(.8rem + .1vw);font-size:calc(.8rem + .1vw);color:#1d2b35;word-wrap:"break-word";overflow-wrap:"break-word"}a.jsx-870580ea71b30c5e{margin:0;text-decoration:none;color:#1d2b35;border-bottom:1px solid}</style><style id="__jsx-fa6f63a6524ee32c">.paragraph.jsx-fa6f63a6524ee32c{font-family:"Source Sans Pro",sans-serif;font-size:1.05rem;color:#a1a1aa;margin:0 0 1.25rem;line-height:1.8}</style><style id="__jsx-f6f1f2b90dda302a">.strong.jsx-f6f1f2b90dda302a{font-weight:700;color:#e4e4e7}</style><style id="__jsx-86f38cbe459c25ed">.heading-2.jsx-86f38cbe459c25ed{font-family:"Maven Pro",sans-serif;font-size:max(1.4rem,min(3vw,1.85rem));font-size:clamp(1.4rem,3vw,1.85rem);font-weight:600;color:#e4e4e7;margin:1.75rem 0 .75rem;line-height:1.35;padding-bottom:8px;border-bottom:1px solid rgba(0,240,255,.15)}</style><style id="__jsx-1f3acd86a8262abc">.emphasis.jsx-1f3acd86a8262abc{font-style:italic;color:#bf00ff}</style><style id="__jsx-3068834386">.code-block.jsx-3068834386{margin:1.5rem 0;position:relative;-webkit-border-radius:8px;-moz-border-radius:8px;border-radius:8px;overflow:hidden}.file-header.jsx-3068834386{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;gap:8px;padding:10px 16px;background:#15151f;border:1px solid rgba(0,240,255,.15);border-bottom:none;-webkit-border-radius:8px 8px 0 0;-moz-border-radius:8px 8px 0 0;border-radius:8px 8px 0 0}.file-icon.jsx-3068834386{font-size:.9rem}.file-name.jsx-3068834386{font-family:"Share Tech Mono",monospace;font-size:.85rem;color:#a1a1aa}.language-badge.jsx-3068834386{position:absolute;top:8px;right:12px;font-family:"Share Tech Mono",monospace;font-size:.7rem;color:#39ff14;background:rgba(57,255,20,.1);padding:4px 8px;-webkit-border-radius:4px;-moz-border-radius:4px;border-radius:4px;border:1px solid rgba(57,255,20,.2);text-transform:uppercase;z-index:1}</style><style id="__jsx-ae081af0992b9daf">.pre-wrapper.jsx-ae081af0992b9daf{margin:1.5rem 0}</style><style id="__jsx-9b0a55d81258b172">.heading-3.jsx-9b0a55d81258b172{font-family:"Maven Pro",sans-serif;font-size:max(1.15rem,min(2.5vw,1.4rem));font-size:clamp(1.15rem,2.5vw,1.4rem);font-weight:600;color:#00f0ff;margin:1.5rem 0 .5rem;line-height:1.4}</style><style id="__jsx-3ac090a85739def3">.heading-4.jsx-3ac090a85739def3{font-family:"Maven Pro",sans-serif;font-size:1.1rem;font-weight:600;color:#bf00ff;margin:1.25rem 0 .5rem}</style><style id="__jsx-4a0fac569cd62d29">.list-item.jsx-4a0fac569cd62d29{padding-left:.5rem}</style><style id="__jsx-95fcca5befc65769">.unordered-list.jsx-95fcca5befc65769{font-family:"Source Sans Pro",sans-serif;font-size:1.05rem;color:#a1a1aa;margin:1rem 0 1.25rem 1.5rem;line-height:1.8}.unordered-list.jsx-95fcca5befc65769 li{margin-bottom:.5rem;position:relative}.unordered-list.jsx-95fcca5befc65769 li::marker{color:#39ff14}</style><style id="__jsx-d03bd386dbbda663">.inline-code.jsx-d03bd386dbbda663{font-family:"Share Tech Mono","Fira Code",Consolas,monospace;font-size:.9em;background:rgba(0,240,255,.1);color:#00f0ff;padding:2px 8px;-webkit-border-radius:4px;-moz-border-radius:4px;border-radius:4px;border:1px solid rgba(0,240,255,.2)}</style><style id="__jsx-1b567b89329bb1f9">.table-header.jsx-1b567b89329bb1f9{padding:12px 16px;text-align:left;font-family:"Share Tech Mono",monospace;font-weight:600;color:#00f0ff;font-size:.85rem;text-transform:uppercase;letter-spacing:.5px;border-bottom:2px solid rgba(0,240,255,.2)}</style><style id="__jsx-dfe7859156a0174a">.table-row.jsx-dfe7859156a0174a{border-bottom:1px solid rgba(255,255,255,.05);-webkit-transition:background.2s ease;-moz-transition:background.2s ease;-o-transition:background.2s ease;transition:background.2s ease}.table-row.jsx-dfe7859156a0174a:hover{background:rgba(0,240,255,.03)}</style><style id="__jsx-6d6a9301fcc0bf87">.table-cell.jsx-6d6a9301fcc0bf87{padding:12px 16px;color:#a1a1aa;border-bottom:1px solid rgba(255,255,255,.05)}</style><style id="__jsx-4c739fccc3d83b4f">.table-wrapper.jsx-4c739fccc3d83b4f{overflow-x:auto;margin:1.5rem 0;-webkit-border-radius:8px;-moz-border-radius:8px;border-radius:8px;border:1px solid rgba(0,240,255,.15)}.table-wrapper.jsx-4c739fccc3d83b4f table{width:100%;border-collapse:collapse;font-family:"Source Sans Pro",sans-serif;font-size:.95rem}</style><style id="__jsx-150839ba60f82142">.divider-wrapper.jsx-150839ba60f82142{margin:2.5rem 0}.divider.jsx-150839ba60f82142{border:none;height:1px;background:-webkit-linear-gradient(left,transparent,rgba(0,240,255,.3),transparent);background:-moz-linear-gradient(left,transparent,rgba(0,240,255,.3),transparent);background:-o-linear-gradient(left,transparent,rgba(0,240,255,.3),transparent);background:linear-gradient(90deg,transparent,rgba(0,240,255,.3),transparent);margin:0}</style><style id="__jsx-49ebcff357f44447">.link.jsx-49ebcff357f44447{color:#00f0ff;text-decoration:none;border-bottom:1px dashed rgba(0,240,255,.4);-webkit-transition:all.2s ease;-moz-transition:all.2s ease;-o-transition:all.2s ease;transition:all.2s ease}.link.jsx-49ebcff357f44447:hover{color:#39ff14;border-bottom-color:#39ff14}</style><style id="__jsx-805584109">.icon-wrapper.jsx-805584109{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-transition:all.3s ease;-moz-transition:all.3s ease;-o-transition:all.3s ease;transition:all.3s ease}.icon-wrapper.jsx-805584109:hover svg{color:#fff!important;-webkit-filter:drop-shadow(0 0 8px #fff);filter:drop-shadow(0 0 8px #fff)}</style><style id="__jsx-3835249677">.icon-wrapper.jsx-3835249677{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-transition:all.3s ease;-moz-transition:all.3s ease;-o-transition:all.3s ease;transition:all.3s ease}.icon-wrapper.jsx-3835249677:hover svg{color:#0e76a8!important;-webkit-filter:drop-shadow(0 0 8px #0e76a8);filter:drop-shadow(0 0 8px #0e76a8)}</style><style id="__jsx-3677045656">.footer.jsx-3677045656{background:-webkit-linear-gradient(top,#0a0a0f 0%,#12121a 100%);background:-moz-linear-gradient(top,#0a0a0f 0%,#12121a 100%);background:-o-linear-gradient(top,#0a0a0f 0%,#12121a 100%);background:linear-gradient(180deg,#0a0a0f 0%,#12121a 100%);border-top:1px solid rgba(0,240,255,.1);padding:2rem 5vw}.footer-content.jsx-3677045656{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;gap:16px}.social-links.jsx-3677045656{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;gap:20px}.social-link.jsx-3677045656{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;width:44px;height:44px;-webkit-border-radius:8px;-moz-border-radius:8px;border-radius:8px;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.08);-webkit-transition:all.3s ease;-moz-transition:all.3s ease;-o-transition:all.3s ease;transition:all.3s ease}.social-link.jsx-3677045656:hover{background:rgba(0,240,255,.1);border-color:rgba(0,240,255,.3);-webkit-transform:translatey(-2px);-moz-transform:translatey(-2px);-ms-transform:translatey(-2px);-o-transform:translatey(-2px);transform:translatey(-2px)}.copyright.jsx-3677045656{font-family:"Share Tech Mono",monospace;font-size:.85rem;color:#71717a;margin:0}.terminal-prompt.jsx-3677045656{color:#00f0ff;margin-right:8px}@media screen and (max-width:640px){.footer.jsx-3677045656{padding:20px 4vw}.social-link.jsx-3677045656{width:40px;height:40px}}</style><style id="__jsx-ebf8a252ba2b54a2">.blog-page.jsx-ebf8a252ba2b54a2{min-height:100vh;background:#0a0a0f}.blog-main.jsx-ebf8a252ba2b54a2{max-width:960px;margin:0 auto;padding:2rem 5vw 4rem}.blog-header.jsx-ebf8a252ba2b54a2{margin-bottom:3rem;padding-bottom:2rem;border-bottom:1px solid rgba(0,240,255,.1)}.blog-header.jsx-ebf8a252ba2b54a2 .back-link{display:inline-block;font-family:"Share Tech Mono",monospace;font-size:.9rem;color:#00f0ff;text-decoration:none;margin-bottom:1.5rem;-webkit-transition:color.2s ease;-moz-transition:color.2s ease;-o-transition:color.2s ease;transition:color.2s ease}.blog-header.jsx-ebf8a252ba2b54a2 .back-link:hover{color:#39ff14}.blog-title.jsx-ebf8a252ba2b54a2{font-family:"Maven Pro",sans-serif;font-size:max(2rem,min(5vw,3rem));font-size:clamp(2rem,5vw,3rem);font-weight:700;color:#e4e4e7;line-height:1.2;margin-bottom:1rem}.blog-meta.jsx-ebf8a252ba2b54a2{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;gap:1rem}.blog-date.jsx-ebf8a252ba2b54a2{font-family:"Share Tech Mono",monospace;font-size:.9rem;color:#00f0ff}.blog-tags.jsx-ebf8a252ba2b54a2{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;gap:8px}.blog-tag.jsx-ebf8a252ba2b54a2{font-family:"Share Tech Mono",monospace;font-size:.8rem;color:#39ff14;padding:4px 10px;background:rgba(57,255,20,.1);border:1px solid rgba(57,255,20,.2);-webkit-border-radius:4px;-moz-border-radius:4px;border-radius:4px}.blog-content.jsx-ebf8a252ba2b54a2{color:#a1a1aa}@media screen and (max-width:768px){.blog-main.jsx-ebf8a252ba2b54a2{padding:1.5rem 4vw 3rem}.blog-header.jsx-ebf8a252ba2b54a2{margin-bottom:2rem;padding-bottom:1.5rem}}</style><style data-href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;600&family=Maven+Pro:wght@400;500;600;700&family=Share+Tech+Mono&family=Source+Sans+Pro:wght@400;600;700&family=Ubuntu:wght@400;500;700&display=swap">@font-face{font-family:'Fira Code';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/l/font?kit=uU9eCBsR6Z2vfE9aq3bL0fxyUs4tcw4W_D1sFVQ&skey=33bc0af28fd31bc7&v=v27) format('woff')}@font-face{font-family:'Fira Code';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/l/font?kit=uU9eCBsR6Z2vfE9aq3bL0fxyUs4tcw4W_A9sFVQ&skey=33bc0af28fd31bc7&v=v27) format('woff')}@font-face{font-family:'Fira Code';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/l/font?kit=uU9eCBsR6Z2vfE9aq3bL0fxyUs4tcw4W_ONrFVQ&skey=33bc0af28fd31bc7&v=v27) format('woff')}@font-face{font-family:'Maven Pro';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/l/font?kit=7Auup_AqnyWWAxW2Wk3swUz56MS91Eww8SX25nM&skey=f795ffecfc1ee92e&v=v40) format('woff')}@font-face{font-family:'Maven Pro';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/l/font?kit=7Auup_AqnyWWAxW2Wk3swUz56MS91Eww8Rf25nM&skey=f795ffecfc1ee92e&v=v40) format('woff')}@font-face{font-family:'Maven Pro';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/l/font?kit=7Auup_AqnyWWAxW2Wk3swUz56MS91Eww8fvx5nM&skey=f795ffecfc1ee92e&v=v40) format('woff')}@font-face{font-family:'Maven Pro';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/l/font?kit=7Auup_AqnyWWAxW2Wk3swUz56MS91Eww8cLx5nM&skey=f795ffecfc1ee92e&v=v40) format('woff')}@font-face{font-family:'Share Tech Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/l/font?kit=J7aHnp1uDWRBEqV98dVQztYldFc7pw&skey=241741910c57ea83&v=v16) format('woff')}@font-face{font-family:'Source Sans Pro';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/l/font?kit=6xK3dSBYKcSV-LCoeQqfX1RYOo3aPA&skey=1e026b1c27170b9b&v=v23) format('woff')}@font-face{font-family:'Source Sans Pro';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/l/font?kit=6xKydSBYKcSV-LCoeQqfX1RYOo3i54rAkw&skey=227a890402fab339&v=v23) format('woff')}@font-face{font-family:'Source Sans Pro';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/l/font?kit=6xKydSBYKcSV-LCoeQqfX1RYOo3ig4vAkw&skey=84e1cdfb74260b1d&v=v23) format('woff')}@font-face{font-family:'Ubuntu';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/l/font?kit=4iCs6KVjbNBYlgo6ew&skey=7e59fc036a1a8481&v=v21) format('woff')}@font-face{font-family:'Ubuntu';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/l/font?kit=4iCv6KVjbNBYlgoCjC3TtA&skey=d8a1e01f6daf5892&v=v21) format('woff')}@font-face{font-family:'Ubuntu';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/l/font?kit=4iCv6KVjbNBYlgoCxCvTtA&skey=403363908a1ded4d&v=v21) format('woff')}@font-face{font-family:'Fira Code';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v27/uU9NCBsR6Z2vfE9aq3bh0NSDqFGedCMX.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C8A,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Fira Code';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v27/uU9NCBsR6Z2vfE9aq3bh2dSDqFGedCMX.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Fira Code';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v27/uU9NCBsR6Z2vfE9aq3bh0dSDqFGedCMX.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Fira Code';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v27/uU9NCBsR6Z2vfE9aq3bh3tSDqFGedCMX.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'Fira Code';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v27/uU9NCBsR6Z2vfE9aq3bhZ_Wmh3mUfBsu_Q.woff2) format('woff2');unicode-range:U+2000-2001,U+2004-2008,U+200A,U+23B8-23BD,U+2500-259F}@font-face{font-family:'Fira Code';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v27/uU9NCBsR6Z2vfE9aq3bh09SDqFGedCMX.woff2) format('woff2');unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Fira Code';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v27/uU9NCBsR6Z2vfE9aq3bh3dSDqFGedA.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Fira Code';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v27/uU9NCBsR6Z2vfE9aq3bh0NSDqFGedCMX.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C8A,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Fira Code';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v27/uU9NCBsR6Z2vfE9aq3bh2dSDqFGedCMX.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Fira Code';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v27/uU9NCBsR6Z2vfE9aq3bh0dSDqFGedCMX.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Fira Code';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v27/uU9NCBsR6Z2vfE9aq3bh3tSDqFGedCMX.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'Fira Code';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v27/uU9NCBsR6Z2vfE9aq3bhZ_Wmh3mUfBsu_Q.woff2) format('woff2');unicode-range:U+2000-2001,U+2004-2008,U+200A,U+23B8-23BD,U+2500-259F}@font-face{font-family:'Fira Code';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v27/uU9NCBsR6Z2vfE9aq3bh09SDqFGedCMX.woff2) format('woff2');unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Fira Code';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v27/uU9NCBsR6Z2vfE9aq3bh3dSDqFGedA.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Fira Code';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v27/uU9NCBsR6Z2vfE9aq3bh0NSDqFGedCMX.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C8A,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Fira Code';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v27/uU9NCBsR6Z2vfE9aq3bh2dSDqFGedCMX.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Fira Code';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v27/uU9NCBsR6Z2vfE9aq3bh0dSDqFGedCMX.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Fira Code';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v27/uU9NCBsR6Z2vfE9aq3bh3tSDqFGedCMX.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'Fira Code';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v27/uU9NCBsR6Z2vfE9aq3bhZ_Wmh3mUfBsu_Q.woff2) format('woff2');unicode-range:U+2000-2001,U+2004-2008,U+200A,U+23B8-23BD,U+2500-259F}@font-face{font-family:'Fira Code';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v27/uU9NCBsR6Z2vfE9aq3bh09SDqFGedCMX.woff2) format('woff2');unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Fira Code';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v27/uU9NCBsR6Z2vfE9aq3bh3dSDqFGedA.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Maven Pro';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/mavenpro/v40/7Au9p_AqnyWWAxW2Wk3GwmQIElsO02Ex.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Maven Pro';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/mavenpro/v40/7Au9p_AqnyWWAxW2Wk3Gw2QIElsO02Ex.woff2) format('woff2');unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Maven Pro';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/mavenpro/v40/7Au9p_AqnyWWAxW2Wk3GzWQIElsO0w.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Maven Pro';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/mavenpro/v40/7Au9p_AqnyWWAxW2Wk3GwmQIElsO02Ex.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Maven Pro';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/mavenpro/v40/7Au9p_AqnyWWAxW2Wk3Gw2QIElsO02Ex.woff2) format('woff2');unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Maven Pro';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/mavenpro/v40/7Au9p_AqnyWWAxW2Wk3GzWQIElsO0w.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Maven Pro';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/mavenpro/v40/7Au9p_AqnyWWAxW2Wk3GwmQIElsO02Ex.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Maven Pro';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/mavenpro/v40/7Au9p_AqnyWWAxW2Wk3Gw2QIElsO02Ex.woff2) format('woff2');unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Maven Pro';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/mavenpro/v40/7Au9p_AqnyWWAxW2Wk3GzWQIElsO0w.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Maven Pro';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/mavenpro/v40/7Au9p_AqnyWWAxW2Wk3GwmQIElsO02Ex.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Maven Pro';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/mavenpro/v40/7Au9p_AqnyWWAxW2Wk3Gw2QIElsO02Ex.woff2) format('woff2');unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Maven Pro';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/mavenpro/v40/7Au9p_AqnyWWAxW2Wk3GzWQIElsO0w.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Share Tech Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/sharetechmono/v16/J7aHnp1uDWRBEqV98dVQztYldFcLowEFA87Heg.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Source Sans Pro';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/sourcesanspro/v23/6xK3dSBYKcSV-LCoeQqfX1RYOo3qNa7lujVj9_mf.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C8A,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Source Sans Pro';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/sourcesanspro/v23/6xK3dSBYKcSV-LCoeQqfX1RYOo3qPK7lujVj9_mf.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Source Sans Pro';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/sourcesanspro/v23/6xK3dSBYKcSV-LCoeQqfX1RYOo3qNK7lujVj9_mf.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Source Sans Pro';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/sourcesanspro/v23/6xK3dSBYKcSV-LCoeQqfX1RYOo3qO67lujVj9_mf.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'Source Sans Pro';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/sourcesanspro/v23/6xK3dSBYKcSV-LCoeQqfX1RYOo3qN67lujVj9_mf.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Source Sans Pro';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/sourcesanspro/v23/6xK3dSBYKcSV-LCoeQqfX1RYOo3qNq7lujVj9_mf.woff2) format('woff2');unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Source Sans Pro';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/sourcesanspro/v23/6xK3dSBYKcSV-LCoeQqfX1RYOo3qOK7lujVj9w.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Source Sans Pro';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/sourcesanspro/v23/6xKydSBYKcSV-LCoeQqfX1RYOo3i54rwmhdu3cOWxy40.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C8A,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Source Sans Pro';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/sourcesanspro/v23/6xKydSBYKcSV-LCoeQqfX1RYOo3i54rwkxdu3cOWxy40.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Source Sans Pro';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/sourcesanspro/v23/6xKydSBYKcSV-LCoeQqfX1RYOo3i54rwmxdu3cOWxy40.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Source Sans Pro';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/sourcesanspro/v23/6xKydSBYKcSV-LCoeQqfX1RYOo3i54rwlBdu3cOWxy40.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'Source Sans Pro';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/sourcesanspro/v23/6xKydSBYKcSV-LCoeQqfX1RYOo3i54rwmBdu3cOWxy40.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Source Sans Pro';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/sourcesanspro/v23/6xKydSBYKcSV-LCoeQqfX1RYOo3i54rwmRdu3cOWxy40.woff2) format('woff2');unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Source Sans Pro';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/sourcesanspro/v23/6xKydSBYKcSV-LCoeQqfX1RYOo3i54rwlxdu3cOWxw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Source Sans Pro';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/sourcesanspro/v23/6xKydSBYKcSV-LCoeQqfX1RYOo3ig4vwmhdu3cOWxy40.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C8A,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Source Sans Pro';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/sourcesanspro/v23/6xKydSBYKcSV-LCoeQqfX1RYOo3ig4vwkxdu3cOWxy40.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Source Sans Pro';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/sourcesanspro/v23/6xKydSBYKcSV-LCoeQqfX1RYOo3ig4vwmxdu3cOWxy40.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Source Sans Pro';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/sourcesanspro/v23/6xKydSBYKcSV-LCoeQqfX1RYOo3ig4vwlBdu3cOWxy40.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'Source Sans Pro';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/sourcesanspro/v23/6xKydSBYKcSV-LCoeQqfX1RYOo3ig4vwmBdu3cOWxy40.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Source Sans Pro';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/sourcesanspro/v23/6xKydSBYKcSV-LCoeQqfX1RYOo3ig4vwmRdu3cOWxy40.woff2) format('woff2');unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Source Sans Pro';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/sourcesanspro/v23/6xKydSBYKcSV-LCoeQqfX1RYOo3ig4vwlxdu3cOWxw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Ubuntu';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ubuntu/v21/4iCs6KVjbNBYlgoKcg72nU6AF7xm.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C8A,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Ubuntu';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ubuntu/v21/4iCs6KVjbNBYlgoKew72nU6AF7xm.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Ubuntu';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ubuntu/v21/4iCs6KVjbNBYlgoKcw72nU6AF7xm.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Ubuntu';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ubuntu/v21/4iCs6KVjbNBYlgoKfA72nU6AF7xm.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'Ubuntu';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ubuntu/v21/4iCs6KVjbNBYlgoKcQ72nU6AF7xm.woff2) format('woff2');unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Ubuntu';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ubuntu/v21/4iCs6KVjbNBYlgoKfw72nU6AFw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Ubuntu';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/ubuntu/v21/4iCv6KVjbNBYlgoCjC3jvWyNPYZvg7UI.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C8A,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Ubuntu';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/ubuntu/v21/4iCv6KVjbNBYlgoCjC3jtGyNPYZvg7UI.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Ubuntu';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/ubuntu/v21/4iCv6KVjbNBYlgoCjC3jvGyNPYZvg7UI.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Ubuntu';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/ubuntu/v21/4iCv6KVjbNBYlgoCjC3js2yNPYZvg7UI.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'Ubuntu';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/ubuntu/v21/4iCv6KVjbNBYlgoCjC3jvmyNPYZvg7UI.woff2) format('woff2');unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Ubuntu';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/ubuntu/v21/4iCv6KVjbNBYlgoCjC3jsGyNPYZvgw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Ubuntu';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/ubuntu/v21/4iCv6KVjbNBYlgoCxCvjvWyNPYZvg7UI.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C8A,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Ubuntu';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/ubuntu/v21/4iCv6KVjbNBYlgoCxCvjtGyNPYZvg7UI.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Ubuntu';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/ubuntu/v21/4iCv6KVjbNBYlgoCxCvjvGyNPYZvg7UI.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Ubuntu';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/ubuntu/v21/4iCv6KVjbNBYlgoCxCvjs2yNPYZvg7UI.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'Ubuntu';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/ubuntu/v21/4iCv6KVjbNBYlgoCxCvjvmyNPYZvg7UI.woff2) format('woff2');unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Ubuntu';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/ubuntu/v21/4iCv6KVjbNBYlgoCxCvjsGyNPYZvgw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body><div id="__next"><div class="jsx-ebf8a252ba2b54a2 blog-page"><header class="jsx-6218e1577aed4ed2 header"><div class="jsx-6218e1577aed4ed2 header-container"><div class="jsx-6218e1577aed4ed2 header-left"><a class="logo-link" href="/"><img alt="Logo" loading="lazy" width="40" height="40" decoding="async" data-nimg="1" class="logo-img" style="color:transparent" src="/images/dawood.png"/><span class="jsx-6218e1577aed4ed2 site-name">Dawood Khan</span></a></div><nav class="jsx-6218e1577aed4ed2 header-right"><a class="nav-link" href="/">Home</a><a class="nav-link" href="/about">About</a></nav></div><div class="jsx-6218e1577aed4ed2 header-description"><p class="jsx-6218e1577aed4ed2">The idea-factory; my journey through technology landscape and entrepreneurship.</p></div><div style="display:none" class="jsx-6218e1577aed4ed2"><div class="jsx-eda6f87527bcedd1 tags-container"><div class="jsx-eda6f87527bcedd1 tags"><a class="tag-link" href="/tags/ai">#<!-- -->ai</a><a class="tag-link" href="/tags/python">#<!-- -->python</a><a class="tag-link" href="/tags/go">#<!-- -->go</a><a class="tag-link" href="/tags/image-processing">#<!-- -->image-processing</a><a class="tag-link" href="/tags/opencv">#<!-- -->opencv</a><a class="tag-link" href="/tags/concurrency">#<!-- -->concurrency</a><a class="tag-link" href="/tags/python-performance">#<!-- -->python-performance</a><a class="tag-link" href="/tags/color-science">#<!-- -->color-science</a><a class="tag-link" href="/tags/react">#<!-- -->react</a><a class="tag-link" href="/tags/next-js">#<!-- -->next-js</a><a class="tag-link" href="/tags/flutter">#<!-- -->flutter</a></div></div></div></header><main class="jsx-ebf8a252ba2b54a2 blog-main"><div class="jsx-ebf8a252ba2b54a2 blog-header"><a class="back-link" href="/">‚Üê Back to all posts</a><h1 class="jsx-ebf8a252ba2b54a2 blog-title">Semantic Cache: Supercharging Agentic AI with Distributed Semantic Search</h1><div class="jsx-ebf8a252ba2b54a2 blog-meta"><span class="jsx-ebf8a252ba2b54a2 blog-date">Jan 14, 2025</span><div class="jsx-ebf8a252ba2b54a2 blog-tags"><span class="jsx-ebf8a252ba2b54a2 blog-tag">#<!-- -->AI</span><span class="jsx-ebf8a252ba2b54a2 blog-tag">#<!-- -->Semantic Search</span><span class="jsx-ebf8a252ba2b54a2 blog-tag">#<!-- -->Distributed Systems</span><span class="jsx-ebf8a252ba2b54a2 blog-tag">#<!-- -->Agentic AI</span><span class="jsx-ebf8a252ba2b54a2 blog-tag">#<!-- -->Apache Arrow</span><span class="jsx-ebf8a252ba2b54a2 blog-tag">#<!-- -->Vector Database</span></div></div></div><article class="jsx-ebf8a252ba2b54a2 blog-content"><p class="jsx-fa6f63a6524ee32c paragraph"><picture class="jsx-870580ea71b30c5e"><img src="/images/semantic-cache/semantic-cache.jpeg" alt="&quot;Semantic Cache Architecture&quot;" style="width:100%;max-width:100%;height:500px;margin-left:0%" class="jsx-870580ea71b30c5e"/><span class="jsx-870580ea71b30c5e img-text"></span></picture></p>
<h6 id="published-on-jan-14-2025">Published on: <strong class="jsx-f6f1f2b90dda302a strong">Jan 14, 2025</strong></h6>
<h2 id="" class="jsx-86f38cbe459c25ed heading-2">Semantic Cache: Supercharging Agentic AI with Distributed Semantic Search</h2>
<h2 id="" class="jsx-86f38cbe459c25ed heading-2">I. Introduction</h2>
<p class="jsx-fa6f63a6524ee32c paragraph">Traditional caching systems require exact key matches to retrieve data. But what if you could find cached information by <em class="jsx-1f3acd86a8262abc emphasis">meaning</em> instead? This is the core idea behind <strong class="jsx-f6f1f2b90dda302a strong">Semantic Cache</strong> - a distributed key-value store I built that combines the speed of traditional caching with the intelligence of semantic search.</p>
<p class="jsx-fa6f63a6524ee32c paragraph">In the world of agentic AI, where autonomous agents need to reason, remember, and act without constant human guidance, semantic caching becomes a game-changer. Instead of agents repeating expensive computations or API calls for semantically similar queries, they can retrieve relevant past results instantly.</p>
<h2 id="" class="jsx-86f38cbe459c25ed heading-2">II. The Problem with Traditional Caching</h2>
<p class="jsx-fa6f63a6524ee32c paragraph">Traditional caching systems like Redis or Memcached are incredibly fast, but they have a fundamental limitation: <strong class="jsx-f6f1f2b90dda302a strong">they only work with exact key matches</strong>.</p>
<p class="jsx-fa6f63a6524ee32c paragraph">Consider this scenario in an agentic AI system:</p>
<div class="jsx-ae081af0992b9daf pre-wrapper"><div class="jsx-3068834386 code-block"><div class="jsx-3068834386 language-badge">python</div><pre style="color:#e4e4e7;background:#0d0d12;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none;padding:1.5em;margin:0;overflow:auto;border-radius:8px;border:1px solid rgba(0, 240, 255, 0.15);border-top:1px solid rgba(0, 240, 255, 0.15)"><code class="language-python" style="color:#e4e4e7;background:none;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none"><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">1</span><span class="token" style="color:#6b7280"># Agent caches a response</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">2</span><span>cache</span><span class="token" style="color:#a1a1aa">.</span><span class="token" style="color:#bf00ff">set</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#39ff14">&quot;How to optimize database queries?&quot;</span><span class="token" style="color:#a1a1aa">,</span><span> response_1</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">3</span>
</span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">4</span><span></span><span class="token" style="color:#6b7280"># Later, a semantically similar question comes in</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">5</span><span>cache</span><span class="token" style="color:#a1a1aa">.</span><span>get</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#39ff14">&quot;database query optimization techniques&quot;</span><span class="token" style="color:#a1a1aa">)</span><span>  </span><span class="token" style="color:#6b7280"># Returns None!</span></span></code></pre></div></div>
<p class="jsx-fa6f63a6524ee32c paragraph">The second query is semantically identical to the first, but traditional caches miss this connection entirely. The agent must recompute or re-fetch the answer, wasting time and resources.</p>
<p class="jsx-fa6f63a6524ee32c paragraph"><strong class="jsx-f6f1f2b90dda302a strong">Semantic Cache solves this</strong> by indexing data with vector embeddings and enabling similarity-based retrieval:</p>
<div class="jsx-ae081af0992b9daf pre-wrapper"><div class="jsx-3068834386 code-block"><div class="jsx-3068834386 language-badge">python</div><pre style="color:#e4e4e7;background:#0d0d12;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none;padding:1.5em;margin:0;overflow:auto;border-radius:8px;border:1px solid rgba(0, 240, 255, 0.15);border-top:1px solid rgba(0, 240, 255, 0.15)"><code class="language-python" style="color:#e4e4e7;background:none;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none"><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">1</span><span class="token" style="color:#6b7280"># Store with semantic indexing</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">2</span><span>semantic_kv</span><span class="token" style="color:#a1a1aa">.</span><span>put</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#39ff14">&quot;optimize-db-001&quot;</span><span class="token" style="color:#a1a1aa">,</span><span> </span><span class="token" style="color:#a1a1aa">{</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">3</span><span>    </span><span class="token" style="color:#39ff14">&quot;query&quot;</span><span class="token" style="color:#a1a1aa">:</span><span> </span><span class="token" style="color:#39ff14">&quot;How to optimize database queries?&quot;</span><span class="token" style="color:#a1a1aa">,</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">4</span><span>    </span><span class="token" style="color:#39ff14">&quot;response&quot;</span><span class="token" style="color:#a1a1aa">:</span><span> </span><span class="token" style="color:#39ff14">&quot;Use indexing, query optimization, caching...&quot;</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">5</span><span></span><span class="token" style="color:#a1a1aa">}</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">6</span>
</span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">7</span><span></span><span class="token" style="color:#6b7280"># Search by meaning - finds the relevant cached response!</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">8</span><span>results </span><span class="token" style="color:#00f0ff">=</span><span> semantic_kv</span><span class="token" style="color:#a1a1aa">.</span><span>search</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#39ff14">&quot;database query optimization techniques&quot;</span><span class="token" style="color:#a1a1aa">,</span><span> top_k</span><span class="token" style="color:#00f0ff">=</span><span class="token" style="color:#ff6b00">3</span><span class="token" style="color:#a1a1aa">)</span></span></code></pre></div></div>
<h2 id="" class="jsx-86f38cbe459c25ed heading-2">III. Technology Stack</h2>
<h3 id="" class="jsx-9b0a55d81258b172 heading-3">Apache Arrow: The Foundation</h3>
<p class="jsx-fa6f63a6524ee32c paragraph"><strong class="jsx-f6f1f2b90dda302a strong">Apache Arrow</strong> is a cross-language development platform for in-memory columnar data. The semantic cache uses Arrow in two critical ways:</p>
<h4 class="jsx-3ac090a85739def3 heading-4">1. Arrow IPC for Persistence</h4>
<p class="jsx-fa6f63a6524ee32c paragraph">The persistence layer uses Arrow&#x27;s IPC (Inter-Process Communication) format to serialize KV entries to disk. The schema is defined as:</p>
<div class="jsx-ae081af0992b9daf pre-wrapper"><div class="jsx-3068834386 code-block"><div class="jsx-3068834386 language-badge">python</div><pre style="color:#e4e4e7;background:#0d0d12;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none;padding:1.5em;margin:0;overflow:auto;border-radius:8px;border:1px solid rgba(0, 240, 255, 0.15);border-top:1px solid rgba(0, 240, 255, 0.15)"><code class="language-python" style="color:#e4e4e7;background:none;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none"><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">1</span><span>KV_SCHEMA </span><span class="token" style="color:#00f0ff">=</span><span> pa</span><span class="token" style="color:#a1a1aa">.</span><span>schema</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#a1a1aa">[</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">2</span><span>    </span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#39ff14">&#x27;key&#x27;</span><span class="token" style="color:#a1a1aa">,</span><span> pa</span><span class="token" style="color:#a1a1aa">.</span><span>string</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">,</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">3</span><span>    </span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#39ff14">&#x27;value&#x27;</span><span class="token" style="color:#a1a1aa">,</span><span> pa</span><span class="token" style="color:#a1a1aa">.</span><span>large_binary</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">,</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">4</span><span>    </span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#39ff14">&#x27;embedding&#x27;</span><span class="token" style="color:#a1a1aa">,</span><span> pa</span><span class="token" style="color:#a1a1aa">.</span><span>list_</span><span class="token" style="color:#a1a1aa">(</span><span>pa</span><span class="token" style="color:#a1a1aa">.</span><span>float32</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">,</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">5</span><span>    </span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#39ff14">&#x27;created_at&#x27;</span><span class="token" style="color:#a1a1aa">,</span><span> pa</span><span class="token" style="color:#a1a1aa">.</span><span>int64</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">,</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">6</span><span>    </span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#39ff14">&#x27;ttl_ms&#x27;</span><span class="token" style="color:#a1a1aa">,</span><span> pa</span><span class="token" style="color:#a1a1aa">.</span><span>int64</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">,</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">7</span><span>    </span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#39ff14">&#x27;access_count&#x27;</span><span class="token" style="color:#a1a1aa">,</span><span> pa</span><span class="token" style="color:#a1a1aa">.</span><span>int64</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">,</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">8</span><span>    </span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#39ff14">&#x27;last_accessed&#x27;</span><span class="token" style="color:#a1a1aa">,</span><span> pa</span><span class="token" style="color:#a1a1aa">.</span><span>int64</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">,</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">9</span><span></span><span class="token" style="color:#a1a1aa">]</span><span class="token" style="color:#a1a1aa">)</span></span></code></pre></div></div>
<p class="jsx-fa6f63a6524ee32c paragraph">This columnar format provides:</p>
<ul class="jsx-95fcca5befc65769 unordered-list">
<li class="jsx-4a0fac569cd62d29 list-item"><strong class="jsx-f6f1f2b90dda302a strong">Efficient compression</strong>: Similar data types stored together compress better</li>
<li class="jsx-4a0fac569cd62d29 list-item"><strong class="jsx-f6f1f2b90dda302a strong">Fast partial reads</strong>: Can read only specific columns without loading entire records</li>
<li class="jsx-4a0fac569cd62d29 list-item"><strong class="jsx-f6f1f2b90dda302a strong">Zero-copy deserialization</strong>: Data can be memory-mapped directly without parsing</li>
<li class="jsx-4a0fac569cd62d29 list-item"><strong class="jsx-f6f1f2b90dda302a strong">Cross-language compatibility</strong>: Arrow files can be read by Python, C++, Java, Rust, etc.</li>
</ul>
<h4 class="jsx-3ac090a85739def3 heading-4">2. Arrow Flight for Network Communication</h4>
<p class="jsx-fa6f63a6524ee32c paragraph"><strong class="jsx-f6f1f2b90dda302a strong">Arrow Flight</strong> is a high-performance RPC framework built on gRPC and Arrow. Each node in the cluster is a Flight server that handles operations via the <code class="jsx-d03bd386dbbda663 inline-code">do_action</code> protocol:</p>
<div class="jsx-ae081af0992b9daf pre-wrapper"><div class="jsx-3068834386 code-block"><div class="jsx-3068834386 language-badge">python</div><pre style="color:#e4e4e7;background:#0d0d12;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none;padding:1.5em;margin:0;overflow:auto;border-radius:8px;border:1px solid rgba(0, 240, 255, 0.15);border-top:1px solid rgba(0, 240, 255, 0.15)"><code class="language-python" style="color:#e4e4e7;background:none;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none"><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">1</span><span class="token" style="color:#ff00aa">class</span><span> </span><span class="token" style="color:#00f0ff">SemanticKVNode</span><span class="token" style="color:#a1a1aa">(</span><span>flight</span><span class="token" style="color:#a1a1aa">.</span><span>FlightServerBase</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">:</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">2</span><span>    </span><span class="token" style="color:#ff00aa">def</span><span> </span><span class="token" style="color:#bf00ff">do_action</span><span class="token" style="color:#a1a1aa">(</span><span>self</span><span class="token" style="color:#a1a1aa">,</span><span> context</span><span class="token" style="color:#a1a1aa">,</span><span> action</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">:</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">3</span><span>        action_type </span><span class="token" style="color:#00f0ff">=</span><span> action</span><span class="token" style="color:#a1a1aa">.</span><span class="token" style="color:#bf00ff">type</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">4</span><span>        body </span><span class="token" style="color:#00f0ff">=</span><span> action</span><span class="token" style="color:#a1a1aa">.</span><span>body</span><span class="token" style="color:#a1a1aa">.</span><span>to_pybytes</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">5</span>
</span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">6</span><span>        </span><span class="token" style="color:#ff00aa">if</span><span> action_type </span><span class="token" style="color:#00f0ff">==</span><span> </span><span class="token" style="color:#39ff14">&quot;put&quot;</span><span class="token" style="color:#a1a1aa">:</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">7</span><span>            </span><span class="token" style="color:#ff00aa">return</span><span> self</span><span class="token" style="color:#a1a1aa">.</span><span>_action_put</span><span class="token" style="color:#a1a1aa">(</span><span>body</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">8</span><span>        </span><span class="token" style="color:#ff00aa">elif</span><span> action_type </span><span class="token" style="color:#00f0ff">==</span><span> </span><span class="token" style="color:#39ff14">&quot;get&quot;</span><span class="token" style="color:#a1a1aa">:</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">9</span><span>            </span><span class="token" style="color:#ff00aa">return</span><span> self</span><span class="token" style="color:#a1a1aa">.</span><span>_action_get</span><span class="token" style="color:#a1a1aa">(</span><span>body</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">10</span><span>        </span><span class="token" style="color:#ff00aa">elif</span><span> action_type </span><span class="token" style="color:#00f0ff">==</span><span> </span><span class="token" style="color:#39ff14">&quot;search_local&quot;</span><span class="token" style="color:#a1a1aa">:</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">11</span><span>            </span><span class="token" style="color:#ff00aa">return</span><span> self</span><span class="token" style="color:#a1a1aa">.</span><span>_action_search_local</span><span class="token" style="color:#a1a1aa">(</span><span>body</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">12</span><span>        </span><span class="token" style="color:#6b7280"># ... other actions</span></span></code></pre></div></div>
<p class="jsx-fa6f63a6524ee32c paragraph">Available Flight actions:</p>
<div class="jsx-4c739fccc3d83b4f table-wrapper"><table class="jsx-4c739fccc3d83b4f "><thead style="background:linear-gradient(135deg, #15151f 0%, #1a1a24 100%)"><tr class="jsx-dfe7859156a0174a table-row"><th class="jsx-1b567b89329bb1f9 table-header">Action</th><th class="jsx-1b567b89329bb1f9 table-header">Description</th></tr></thead><tbody><tr class="jsx-dfe7859156a0174a table-row"><td class="jsx-6d6a9301fcc0bf87 table-cell"><code class="jsx-d03bd386dbbda663 inline-code">put</code></td><td class="jsx-6d6a9301fcc0bf87 table-cell">Store key-value pair with embedding</td></tr><tr class="jsx-dfe7859156a0174a table-row"><td class="jsx-6d6a9301fcc0bf87 table-cell"><code class="jsx-d03bd386dbbda663 inline-code">put_replica</code></td><td class="jsx-6d6a9301fcc0bf87 table-cell">Store replica (internal, from other nodes)</td></tr><tr class="jsx-dfe7859156a0174a table-row"><td class="jsx-6d6a9301fcc0bf87 table-cell"><code class="jsx-d03bd386dbbda663 inline-code">get</code></td><td class="jsx-6d6a9301fcc0bf87 table-cell">Exact key lookup with TTL check</td></tr><tr class="jsx-dfe7859156a0174a table-row"><td class="jsx-6d6a9301fcc0bf87 table-cell"><code class="jsx-d03bd386dbbda663 inline-code">search_local</code></td><td class="jsx-6d6a9301fcc0bf87 table-cell">Semantic search on local HNSW index</td></tr><tr class="jsx-dfe7859156a0174a table-row"><td class="jsx-6d6a9301fcc0bf87 table-cell"><code class="jsx-d03bd386dbbda663 inline-code">delete</code></td><td class="jsx-6d6a9301fcc0bf87 table-cell">Remove key from store and index</td></tr><tr class="jsx-dfe7859156a0174a table-row"><td class="jsx-6d6a9301fcc0bf87 table-cell"><code class="jsx-d03bd386dbbda663 inline-code">scan</code></td><td class="jsx-6d6a9301fcc0bf87 table-cell">List keys by prefix</td></tr><tr class="jsx-dfe7859156a0174a table-row"><td class="jsx-6d6a9301fcc0bf87 table-cell"><code class="jsx-d03bd386dbbda663 inline-code">stats</code></td><td class="jsx-6d6a9301fcc0bf87 table-cell">Return node statistics</td></tr><tr class="jsx-dfe7859156a0174a table-row"><td class="jsx-6d6a9301fcc0bf87 table-cell"><code class="jsx-d03bd386dbbda663 inline-code">health</code></td><td class="jsx-6d6a9301fcc0bf87 table-cell">Health check</td></tr><tr class="jsx-dfe7859156a0174a table-row"><td class="jsx-6d6a9301fcc0bf87 table-cell"><code class="jsx-d03bd386dbbda663 inline-code">clear</code></td><td class="jsx-6d6a9301fcc0bf87 table-cell">Clear all data</td></tr></tbody></table></div>
<p class="jsx-fa6f63a6524ee32c paragraph"><strong class="jsx-f6f1f2b90dda302a strong">Why Arrow Flight over plain gRPC?</strong></p>
<ul class="jsx-95fcca5befc65769 unordered-list">
<li class="jsx-4a0fac569cd62d29 list-item"><strong class="jsx-f6f1f2b90dda302a strong">Native columnar data</strong>: Perfect for batch operations and large result sets</li>
<li class="jsx-4a0fac569cd62d29 list-item"><strong class="jsx-f6f1f2b90dda302a strong">Zero-copy semantics</strong>: Data moves directly from network buffer to application</li>
<li class="jsx-4a0fac569cd62d29 list-item"><strong class="jsx-f6f1f2b90dda302a strong">Built-in streaming</strong>: Efficient for large result sets without loading all into memory</li>
<li class="jsx-4a0fac569cd62d29 list-item"><strong class="jsx-f6f1f2b90dda302a strong">Standard protocol</strong>: Interoperable with Arrow ecosystem (Spark, Pandas, DuckDB)</li>
</ul>
<h2 id="" class="jsx-86f38cbe459c25ed heading-2">IV. In-Memory Storage Architecture</h2>
<h3 id="" class="jsx-9b0a55d81258b172 heading-3">Primary Storage: Python Dictionary</h3>
<p class="jsx-fa6f63a6524ee32c paragraph">The cache operates as an <strong class="jsx-f6f1f2b90dda302a strong">in-memory first</strong> system. Each node maintains data in a Python dictionary with <code class="jsx-d03bd386dbbda663 inline-code">KVEntry</code> dataclass objects:</p>
<div class="jsx-ae081af0992b9daf pre-wrapper"><div class="jsx-3068834386 code-block"><div class="jsx-3068834386 language-badge">python</div><pre style="color:#e4e4e7;background:#0d0d12;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none;padding:1.5em;margin:0;overflow:auto;border-radius:8px;border:1px solid rgba(0, 240, 255, 0.15);border-top:1px solid rgba(0, 240, 255, 0.15)"><code class="language-python" style="color:#e4e4e7;background:none;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none"><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">1</span><span class="token decorator annotation" style="color:#a1a1aa">@dataclass</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">2</span><span></span><span class="token" style="color:#ff00aa">class</span><span> </span><span class="token" style="color:#00f0ff">KVEntry</span><span class="token" style="color:#a1a1aa">:</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">3</span><span>    key</span><span class="token" style="color:#a1a1aa">:</span><span> </span><span class="token" style="color:#bf00ff">str</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">4</span><span>    value</span><span class="token" style="color:#a1a1aa">:</span><span> </span><span class="token" style="color:#bf00ff">bytes</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">5</span><span>    embedding</span><span class="token" style="color:#a1a1aa">:</span><span> np</span><span class="token" style="color:#a1a1aa">.</span><span>ndarray      </span><span class="token" style="color:#6b7280"># Vector embedding (384-3072 dims)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">6</span><span>    created_at</span><span class="token" style="color:#a1a1aa">:</span><span> </span><span class="token" style="color:#bf00ff">int</span><span>            </span><span class="token" style="color:#6b7280"># Timestamp (milliseconds)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">7</span><span>    ttl_ms</span><span class="token" style="color:#a1a1aa">:</span><span> </span><span class="token" style="color:#bf00ff">int</span><span>                </span><span class="token" style="color:#6b7280"># Time-to-live (0 = no expiration)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">8</span><span>    access_count</span><span class="token" style="color:#a1a1aa">:</span><span> </span><span class="token" style="color:#bf00ff">int</span><span> </span><span class="token" style="color:#00f0ff">=</span><span> </span><span class="token" style="color:#ff6b00">0</span><span>      </span><span class="token" style="color:#6b7280"># Access statistics</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">9</span><span>    last_accessed</span><span class="token" style="color:#a1a1aa">:</span><span> </span><span class="token" style="color:#bf00ff">int</span><span> </span><span class="token" style="color:#00f0ff">=</span><span> </span><span class="token" style="color:#ff6b00">0</span><span>     </span><span class="token" style="color:#6b7280"># Last access timestamp</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">10</span>
</span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">11</span><span></span><span class="token" style="color:#6b7280"># Storage structure</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">12</span><span>self</span><span class="token" style="color:#a1a1aa">.</span><span>_store</span><span class="token" style="color:#a1a1aa">:</span><span> Dict</span><span class="token" style="color:#a1a1aa">[</span><span class="token" style="color:#bf00ff">str</span><span class="token" style="color:#a1a1aa">,</span><span> KVEntry</span><span class="token" style="color:#a1a1aa">]</span><span> </span><span class="token" style="color:#00f0ff">=</span><span> </span><span class="token" style="color:#a1a1aa">{</span><span class="token" style="color:#a1a1aa">}</span></span></code></pre></div></div>
<h3 id="" class="jsx-9b0a55d81258b172 heading-3">Thread Safety</h3>
<p class="jsx-fa6f63a6524ee32c paragraph">All operations are protected by a reentrant lock (<code class="jsx-d03bd386dbbda663 inline-code">threading.RLock</code>):</p>
<div class="jsx-ae081af0992b9daf pre-wrapper"><div class="jsx-3068834386 code-block"><div class="jsx-3068834386 language-badge">python</div><pre style="color:#e4e4e7;background:#0d0d12;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none;padding:1.5em;margin:0;overflow:auto;border-radius:8px;border:1px solid rgba(0, 240, 255, 0.15);border-top:1px solid rgba(0, 240, 255, 0.15)"><code class="language-python" style="color:#e4e4e7;background:none;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none"><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">1</span><span class="token" style="color:#ff00aa">def</span><span> </span><span class="token" style="color:#bf00ff">_action_get</span><span class="token" style="color:#a1a1aa">(</span><span>self</span><span class="token" style="color:#a1a1aa">,</span><span> body</span><span class="token" style="color:#a1a1aa">:</span><span> </span><span class="token" style="color:#bf00ff">bytes</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">:</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">2</span><span>    key </span><span class="token" style="color:#00f0ff">=</span><span> body</span><span class="token" style="color:#a1a1aa">.</span><span>decode</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">3</span>
</span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">4</span><span>    </span><span class="token" style="color:#ff00aa">with</span><span> self</span><span class="token" style="color:#a1a1aa">.</span><span>_lock</span><span class="token" style="color:#a1a1aa">:</span><span>  </span><span class="token" style="color:#6b7280"># Thread-safe access</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">5</span><span>        </span><span class="token" style="color:#ff00aa">if</span><span> key </span><span class="token" style="color:#ff00aa">not</span><span> </span><span class="token" style="color:#ff00aa">in</span><span> self</span><span class="token" style="color:#a1a1aa">.</span><span>_store</span><span class="token" style="color:#a1a1aa">:</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">6</span><span>            </span><span class="token" style="color:#ff00aa">return</span><span> </span><span class="token" style="color:#a1a1aa">[</span><span>flight</span><span class="token" style="color:#a1a1aa">.</span><span>Result</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#39ff14">b&quot;&quot;</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">]</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">7</span>
</span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">8</span><span>        entry </span><span class="token" style="color:#00f0ff">=</span><span> self</span><span class="token" style="color:#a1a1aa">.</span><span>_store</span><span class="token" style="color:#a1a1aa">[</span><span>key</span><span class="token" style="color:#a1a1aa">]</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">9</span>
</span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">10</span><span>        </span><span class="token" style="color:#6b7280"># Check expiration</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">11</span><span>        </span><span class="token" style="color:#ff00aa">if</span><span> self</span><span class="token" style="color:#a1a1aa">.</span><span>_is_expired</span><span class="token" style="color:#a1a1aa">(</span><span>entry</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">:</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">12</span><span>            self</span><span class="token" style="color:#a1a1aa">.</span><span>_delete_entry</span><span class="token" style="color:#a1a1aa">(</span><span>key</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">13</span><span>            </span><span class="token" style="color:#ff00aa">return</span><span> </span><span class="token" style="color:#a1a1aa">[</span><span>flight</span><span class="token" style="color:#a1a1aa">.</span><span>Result</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#39ff14">b&quot;&quot;</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">]</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">14</span>
</span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">15</span><span>        </span><span class="token" style="color:#6b7280"># Update access stats</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">16</span><span>        entry</span><span class="token" style="color:#a1a1aa">.</span><span>access_count </span><span class="token" style="color:#00f0ff">+=</span><span> </span><span class="token" style="color:#ff6b00">1</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">17</span><span>        entry</span><span class="token" style="color:#a1a1aa">.</span><span>last_accessed </span><span class="token" style="color:#00f0ff">=</span><span> </span><span class="token" style="color:#bf00ff">int</span><span class="token" style="color:#a1a1aa">(</span><span>time</span><span class="token" style="color:#a1a1aa">.</span><span>time</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#a1a1aa">)</span><span> </span><span class="token" style="color:#00f0ff">*</span><span> </span><span class="token" style="color:#ff6b00">1000</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">18</span>
</span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">19</span><span>        </span><span class="token" style="color:#ff00aa">return</span><span> </span><span class="token" style="color:#a1a1aa">[</span><span>flight</span><span class="token" style="color:#a1a1aa">.</span><span>Result</span><span class="token" style="color:#a1a1aa">(</span><span>entry</span><span class="token" style="color:#a1a1aa">.</span><span>value</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">]</span></span></code></pre></div></div>
<h3 id="" class="jsx-9b0a55d81258b172 heading-3">TTL Expiration</h3>
<p class="jsx-fa6f63a6524ee32c paragraph">Entries support time-to-live with lazy expiration checking:</p>
<div class="jsx-ae081af0992b9daf pre-wrapper"><div class="jsx-3068834386 code-block"><div class="jsx-3068834386 language-badge">python</div><pre style="color:#e4e4e7;background:#0d0d12;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none;padding:1.5em;margin:0;overflow:auto;border-radius:8px;border:1px solid rgba(0, 240, 255, 0.15);border-top:1px solid rgba(0, 240, 255, 0.15)"><code class="language-python" style="color:#e4e4e7;background:none;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none"><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">1</span><span class="token" style="color:#ff00aa">def</span><span> </span><span class="token" style="color:#bf00ff">_is_expired</span><span class="token" style="color:#a1a1aa">(</span><span>self</span><span class="token" style="color:#a1a1aa">,</span><span> entry</span><span class="token" style="color:#a1a1aa">:</span><span> KVEntry</span><span class="token" style="color:#a1a1aa">)</span><span> </span><span class="token" style="color:#00f0ff">-</span><span class="token" style="color:#00f0ff">&gt;</span><span> </span><span class="token" style="color:#bf00ff">bool</span><span class="token" style="color:#a1a1aa">:</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">2</span><span>    </span><span class="token" style="color:#ff00aa">if</span><span> entry</span><span class="token" style="color:#a1a1aa">.</span><span>ttl_ms </span><span class="token" style="color:#00f0ff">&lt;=</span><span> </span><span class="token" style="color:#ff6b00">0</span><span class="token" style="color:#a1a1aa">:</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">3</span><span>        </span><span class="token" style="color:#ff00aa">return</span><span> </span><span class="token" style="color:#ff6b00">False</span><span>  </span><span class="token" style="color:#6b7280"># No expiration</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">4</span><span>    now_ms </span><span class="token" style="color:#00f0ff">=</span><span> </span><span class="token" style="color:#bf00ff">int</span><span class="token" style="color:#a1a1aa">(</span><span>time</span><span class="token" style="color:#a1a1aa">.</span><span>time</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#a1a1aa">)</span><span> </span><span class="token" style="color:#00f0ff">*</span><span> </span><span class="token" style="color:#ff6b00">1000</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">5</span><span>    </span><span class="token" style="color:#ff00aa">return</span><span> </span><span class="token" style="color:#a1a1aa">(</span><span>now_ms </span><span class="token" style="color:#00f0ff">-</span><span> entry</span><span class="token" style="color:#a1a1aa">.</span><span>created_at</span><span class="token" style="color:#a1a1aa">)</span><span> </span><span class="token" style="color:#00f0ff">&gt;</span><span> entry</span><span class="token" style="color:#a1a1aa">.</span><span>ttl_ms</span></span></code></pre></div></div>
<h2 id="" class="jsx-86f38cbe459c25ed heading-2">V. Persistence Layer</h2>
<p class="jsx-fa6f63a6524ee32c paragraph">While the primary storage is in-memory, the system provides durable persistence through the <code class="jsx-d03bd386dbbda663 inline-code">ArrowKVStore</code> class:</p>
<h3 id="" class="jsx-9b0a55d81258b172 heading-3">Saving Data</h3>
<div class="jsx-ae081af0992b9daf pre-wrapper"><div class="jsx-3068834386 code-block"><div class="jsx-3068834386 language-badge">python</div><pre style="color:#e4e4e7;background:#0d0d12;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none;padding:1.5em;margin:0;overflow:auto;border-radius:8px;border:1px solid rgba(0, 240, 255, 0.15);border-top:1px solid rgba(0, 240, 255, 0.15)"><code class="language-python" style="color:#e4e4e7;background:none;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none"><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">1</span><span class="token" style="color:#ff00aa">class</span><span> </span><span class="token" style="color:#00f0ff">ArrowKVStore</span><span class="token" style="color:#a1a1aa">:</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">2</span><span>    </span><span class="token" style="color:#ff00aa">def</span><span> </span><span class="token" style="color:#bf00ff">save</span><span class="token" style="color:#a1a1aa">(</span><span>self</span><span class="token" style="color:#a1a1aa">,</span><span> entries</span><span class="token" style="color:#a1a1aa">:</span><span> Dict</span><span class="token" style="color:#a1a1aa">[</span><span class="token" style="color:#bf00ff">str</span><span class="token" style="color:#a1a1aa">,</span><span> KVEntry</span><span class="token" style="color:#a1a1aa">]</span><span class="token" style="color:#a1a1aa">,</span><span> index</span><span class="token" style="color:#00f0ff">=</span><span class="token" style="color:#ff6b00">None</span><span class="token" style="color:#a1a1aa">,</span><span> metadata</span><span class="token" style="color:#00f0ff">=</span><span class="token" style="color:#ff6b00">None</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">:</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">3</span><span>        </span><span class="token" style="color:#6b7280"># Convert entries to Arrow table</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">4</span><span>        keys</span><span class="token" style="color:#a1a1aa">,</span><span> values</span><span class="token" style="color:#a1a1aa">,</span><span> embeddings </span><span class="token" style="color:#00f0ff">=</span><span> </span><span class="token" style="color:#a1a1aa">[</span><span class="token" style="color:#a1a1aa">]</span><span class="token" style="color:#a1a1aa">,</span><span> </span><span class="token" style="color:#a1a1aa">[</span><span class="token" style="color:#a1a1aa">]</span><span class="token" style="color:#a1a1aa">,</span><span> </span><span class="token" style="color:#a1a1aa">[</span><span class="token" style="color:#a1a1aa">]</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">5</span><span>        </span><span class="token" style="color:#ff00aa">for</span><span> key</span><span class="token" style="color:#a1a1aa">,</span><span> entry </span><span class="token" style="color:#ff00aa">in</span><span> entries</span><span class="token" style="color:#a1a1aa">.</span><span>items</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">:</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">6</span><span>            keys</span><span class="token" style="color:#a1a1aa">.</span><span>append</span><span class="token" style="color:#a1a1aa">(</span><span>key</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">7</span><span>            values</span><span class="token" style="color:#a1a1aa">.</span><span>append</span><span class="token" style="color:#a1a1aa">(</span><span>entry</span><span class="token" style="color:#a1a1aa">.</span><span>value</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">8</span><span>            embeddings</span><span class="token" style="color:#a1a1aa">.</span><span>append</span><span class="token" style="color:#a1a1aa">(</span><span>entry</span><span class="token" style="color:#a1a1aa">.</span><span>embedding</span><span class="token" style="color:#a1a1aa">.</span><span>tolist</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">9</span>
</span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">10</span><span>        table </span><span class="token" style="color:#00f0ff">=</span><span> pa</span><span class="token" style="color:#a1a1aa">.</span><span>Table</span><span class="token" style="color:#a1a1aa">.</span><span>from_arrays</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#a1a1aa">[</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">11</span><span>            pa</span><span class="token" style="color:#a1a1aa">.</span><span>array</span><span class="token" style="color:#a1a1aa">(</span><span>keys</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">,</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">12</span><span>            pa</span><span class="token" style="color:#a1a1aa">.</span><span>array</span><span class="token" style="color:#a1a1aa">(</span><span>values</span><span class="token" style="color:#a1a1aa">,</span><span> </span><span class="token" style="color:#bf00ff">type</span><span class="token" style="color:#00f0ff">=</span><span>pa</span><span class="token" style="color:#a1a1aa">.</span><span>large_binary</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">,</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">13</span><span>            pa</span><span class="token" style="color:#a1a1aa">.</span><span>array</span><span class="token" style="color:#a1a1aa">(</span><span>embeddings</span><span class="token" style="color:#a1a1aa">,</span><span> </span><span class="token" style="color:#bf00ff">type</span><span class="token" style="color:#00f0ff">=</span><span>pa</span><span class="token" style="color:#a1a1aa">.</span><span>list_</span><span class="token" style="color:#a1a1aa">(</span><span>pa</span><span class="token" style="color:#a1a1aa">.</span><span>float32</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">,</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">14</span><span>            </span><span class="token" style="color:#6b7280"># ... other columns</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">15</span><span>        </span><span class="token" style="color:#a1a1aa">]</span><span class="token" style="color:#a1a1aa">,</span><span> schema</span><span class="token" style="color:#00f0ff">=</span><span>KV_SCHEMA</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">16</span>
</span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">17</span><span>        </span><span class="token" style="color:#6b7280"># Write to Arrow IPC file</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">18</span><span>        </span><span class="token" style="color:#ff00aa">with</span><span> pa</span><span class="token" style="color:#a1a1aa">.</span><span>OSFile</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#bf00ff">str</span><span class="token" style="color:#a1a1aa">(</span><span>self</span><span class="token" style="color:#a1a1aa">.</span><span>_data_file</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">,</span><span> </span><span class="token" style="color:#39ff14">&#x27;wb&#x27;</span><span class="token" style="color:#a1a1aa">)</span><span> </span><span class="token" style="color:#ff00aa">as</span><span> sink</span><span class="token" style="color:#a1a1aa">:</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">19</span><span>            writer </span><span class="token" style="color:#00f0ff">=</span><span> ipc</span><span class="token" style="color:#a1a1aa">.</span><span>new_file</span><span class="token" style="color:#a1a1aa">(</span><span>sink</span><span class="token" style="color:#a1a1aa">,</span><span> table</span><span class="token" style="color:#a1a1aa">.</span><span>schema</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">20</span><span>            writer</span><span class="token" style="color:#a1a1aa">.</span><span>write_table</span><span class="token" style="color:#a1a1aa">(</span><span>table</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">21</span><span>            writer</span><span class="token" style="color:#a1a1aa">.</span><span>close</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#a1a1aa">)</span></span></code></pre></div></div>
<h3 id="" class="jsx-9b0a55d81258b172 heading-3">Loading Data</h3>
<div class="jsx-ae081af0992b9daf pre-wrapper"><div class="jsx-3068834386 code-block"><div class="jsx-3068834386 language-badge">python</div><pre style="color:#e4e4e7;background:#0d0d12;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none;padding:1.5em;margin:0;overflow:auto;border-radius:8px;border:1px solid rgba(0, 240, 255, 0.15);border-top:1px solid rgba(0, 240, 255, 0.15)"><code class="language-python" style="color:#e4e4e7;background:none;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none"><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">1</span><span class="token" style="color:#ff00aa">def</span><span> </span><span class="token" style="color:#bf00ff">load</span><span class="token" style="color:#a1a1aa">(</span><span>self</span><span class="token" style="color:#a1a1aa">)</span><span> </span><span class="token" style="color:#00f0ff">-</span><span class="token" style="color:#00f0ff">&gt;</span><span> Tuple</span><span class="token" style="color:#a1a1aa">[</span><span>List</span><span class="token" style="color:#a1a1aa">[</span><span>PersistedEntry</span><span class="token" style="color:#a1a1aa">]</span><span class="token" style="color:#a1a1aa">,</span><span> Dict</span><span class="token" style="color:#a1a1aa">]</span><span class="token" style="color:#a1a1aa">:</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">2</span><span>    </span><span class="token" style="color:#6b7280"># Memory-map the Arrow file for zero-copy reads</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">3</span><span>    </span><span class="token" style="color:#ff00aa">with</span><span> pa</span><span class="token" style="color:#a1a1aa">.</span><span>memory_map</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#bf00ff">str</span><span class="token" style="color:#a1a1aa">(</span><span>self</span><span class="token" style="color:#a1a1aa">.</span><span>_data_file</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">,</span><span> </span><span class="token" style="color:#39ff14">&#x27;r&#x27;</span><span class="token" style="color:#a1a1aa">)</span><span> </span><span class="token" style="color:#ff00aa">as</span><span> source</span><span class="token" style="color:#a1a1aa">:</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">4</span><span>        reader </span><span class="token" style="color:#00f0ff">=</span><span> ipc</span><span class="token" style="color:#a1a1aa">.</span><span>open_file</span><span class="token" style="color:#a1a1aa">(</span><span>source</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">5</span><span>        table </span><span class="token" style="color:#00f0ff">=</span><span> reader</span><span class="token" style="color:#a1a1aa">.</span><span>read_all</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">6</span>
</span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">7</span><span>    entries </span><span class="token" style="color:#00f0ff">=</span><span> </span><span class="token" style="color:#a1a1aa">[</span><span class="token" style="color:#a1a1aa">]</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">8</span><span>    </span><span class="token" style="color:#ff00aa">for</span><span> i </span><span class="token" style="color:#ff00aa">in</span><span> </span><span class="token" style="color:#bf00ff">range</span><span class="token" style="color:#a1a1aa">(</span><span>table</span><span class="token" style="color:#a1a1aa">.</span><span>num_rows</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">:</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">9</span><span>        entry </span><span class="token" style="color:#00f0ff">=</span><span> PersistedEntry</span><span class="token" style="color:#a1a1aa">(</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">10</span><span>            key</span><span class="token" style="color:#00f0ff">=</span><span>table</span><span class="token" style="color:#a1a1aa">[</span><span class="token" style="color:#39ff14">&#x27;key&#x27;</span><span class="token" style="color:#a1a1aa">]</span><span class="token" style="color:#a1a1aa">[</span><span>i</span><span class="token" style="color:#a1a1aa">]</span><span class="token" style="color:#a1a1aa">.</span><span>as_py</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">,</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">11</span><span>            value</span><span class="token" style="color:#00f0ff">=</span><span>table</span><span class="token" style="color:#a1a1aa">[</span><span class="token" style="color:#39ff14">&#x27;value&#x27;</span><span class="token" style="color:#a1a1aa">]</span><span class="token" style="color:#a1a1aa">[</span><span>i</span><span class="token" style="color:#a1a1aa">]</span><span class="token" style="color:#a1a1aa">.</span><span>as_py</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">,</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">12</span><span>            embedding</span><span class="token" style="color:#00f0ff">=</span><span>np</span><span class="token" style="color:#a1a1aa">.</span><span>array</span><span class="token" style="color:#a1a1aa">(</span><span>table</span><span class="token" style="color:#a1a1aa">[</span><span class="token" style="color:#39ff14">&#x27;embedding&#x27;</span><span class="token" style="color:#a1a1aa">]</span><span class="token" style="color:#a1a1aa">[</span><span>i</span><span class="token" style="color:#a1a1aa">]</span><span class="token" style="color:#a1a1aa">.</span><span>as_py</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">,</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">13</span><span>            </span><span class="token" style="color:#6b7280"># ... other fields</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">14</span><span>        </span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">15</span><span>        entries</span><span class="token" style="color:#a1a1aa">.</span><span>append</span><span class="token" style="color:#a1a1aa">(</span><span>entry</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">16</span>
</span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">17</span><span>    </span><span class="token" style="color:#ff00aa">return</span><span> entries</span><span class="token" style="color:#a1a1aa">,</span><span> metadata</span></span></code></pre></div></div>
<h3 id="" class="jsx-9b0a55d81258b172 heading-3">HNSW Index Persistence</h3>
<p class="jsx-fa6f63a6524ee32c paragraph">The HNSW index is persisted separately using hnswlib&#x27;s native format:</p>
<div class="jsx-ae081af0992b9daf pre-wrapper"><div class="jsx-3068834386 code-block"><div class="jsx-3068834386 language-badge">python</div><pre style="color:#e4e4e7;background:#0d0d12;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none;padding:1.5em;margin:0;overflow:auto;border-radius:8px;border:1px solid rgba(0, 240, 255, 0.15);border-top:1px solid rgba(0, 240, 255, 0.15)"><code class="language-python" style="color:#e4e4e7;background:none;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none"><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">1</span><span class="token" style="color:#6b7280"># Saving</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">2</span><span>index</span><span class="token" style="color:#a1a1aa">.</span><span>save_index</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#bf00ff">str</span><span class="token" style="color:#a1a1aa">(</span><span>self</span><span class="token" style="color:#a1a1aa">.</span><span>_index_file</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">3</span>
</span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">4</span><span></span><span class="token" style="color:#6b7280"># Loading</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">5</span><span>index </span><span class="token" style="color:#00f0ff">=</span><span> hnswlib</span><span class="token" style="color:#a1a1aa">.</span><span>Index</span><span class="token" style="color:#a1a1aa">(</span><span>space</span><span class="token" style="color:#00f0ff">=</span><span class="token" style="color:#39ff14">&#x27;cosine&#x27;</span><span class="token" style="color:#a1a1aa">,</span><span> dim</span><span class="token" style="color:#00f0ff">=</span><span>dim</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">6</span><span>index</span><span class="token" style="color:#a1a1aa">.</span><span>load_index</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#bf00ff">str</span><span class="token" style="color:#a1a1aa">(</span><span>self</span><span class="token" style="color:#a1a1aa">.</span><span>_index_file</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">)</span></span></code></pre></div></div>
<h3 id="" class="jsx-9b0a55d81258b172 heading-3">Snapshot Manager</h3>
<p class="jsx-fa6f63a6524ee32c paragraph">For backup and recovery, the <code class="jsx-d03bd386dbbda663 inline-code">SnapshotManager</code> provides:</p>
<div class="jsx-ae081af0992b9daf pre-wrapper"><div class="jsx-3068834386 code-block"><div class="jsx-3068834386 language-badge">python</div><pre style="color:#e4e4e7;background:#0d0d12;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none;padding:1.5em;margin:0;overflow:auto;border-radius:8px;border:1px solid rgba(0, 240, 255, 0.15);border-top:1px solid rgba(0, 240, 255, 0.15)"><code class="language-python" style="color:#e4e4e7;background:none;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none"><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">1</span><span class="token" style="color:#ff00aa">class</span><span> </span><span class="token" style="color:#00f0ff">SnapshotManager</span><span class="token" style="color:#a1a1aa">:</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">2</span><span>    </span><span class="token" style="color:#ff00aa">def</span><span> </span><span class="token" style="color:#bf00ff">create_snapshot</span><span class="token" style="color:#a1a1aa">(</span><span>self</span><span class="token" style="color:#a1a1aa">,</span><span> name</span><span class="token" style="color:#a1a1aa">:</span><span> </span><span class="token" style="color:#bf00ff">str</span><span> </span><span class="token" style="color:#00f0ff">=</span><span> </span><span class="token" style="color:#ff6b00">None</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">:</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">3</span><span>        </span><span class="token" style="color:#6b7280"># Copy all data files to snapshot directory</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">4</span><span>        shutil</span><span class="token" style="color:#a1a1aa">.</span><span>copytree</span><span class="token" style="color:#a1a1aa">(</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">5</span><span>            self</span><span class="token" style="color:#a1a1aa">.</span><span>_data_dir</span><span class="token" style="color:#a1a1aa">,</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">6</span><span>            snapshot_dir</span><span class="token" style="color:#a1a1aa">,</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">7</span><span>            ignore</span><span class="token" style="color:#00f0ff">=</span><span>shutil</span><span class="token" style="color:#a1a1aa">.</span><span>ignore_patterns</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#39ff14">&#x27;snapshots&#x27;</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">8</span><span>        </span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">9</span>
</span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">10</span><span>    </span><span class="token" style="color:#ff00aa">def</span><span> </span><span class="token" style="color:#bf00ff">restore_snapshot</span><span class="token" style="color:#a1a1aa">(</span><span>self</span><span class="token" style="color:#a1a1aa">,</span><span> name</span><span class="token" style="color:#a1a1aa">:</span><span> </span><span class="token" style="color:#bf00ff">str</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">:</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">11</span><span>        </span><span class="token" style="color:#6b7280"># Remove current data, copy snapshot back</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">12</span><span>        </span><span class="token" style="color:#a1a1aa">.</span><span class="token" style="color:#a1a1aa">.</span><span class="token" style="color:#a1a1aa">.</span></span></code></pre></div></div>
<h2 id="" class="jsx-86f38cbe459c25ed heading-2">VI. Cluster Formation and Topology</h2>
<h3 id="" class="jsx-9b0a55d81258b172 heading-3">Static Node Configuration</h3>
<p class="jsx-fa6f63a6524ee32c paragraph">The cluster uses a <strong class="jsx-f6f1f2b90dda302a strong">static configuration</strong> model where nodes are known at startup:</p>
<div class="jsx-ae081af0992b9daf pre-wrapper"><div class="jsx-3068834386 code-block"><div class="jsx-3068834386 language-badge">python</div><pre style="color:#e4e4e7;background:#0d0d12;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none;padding:1.5em;margin:0;overflow:auto;border-radius:8px;border:1px solid rgba(0, 240, 255, 0.15);border-top:1px solid rgba(0, 240, 255, 0.15)"><code class="language-python" style="color:#e4e4e7;background:none;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none"><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">1</span><span class="token" style="color:#6b7280"># Client connects to pre-configured nodes</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">2</span><span>client </span><span class="token" style="color:#00f0ff">=</span><span> DistributedSemanticKV</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#a1a1aa">[</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">3</span><span>    </span><span class="token" style="color:#39ff14">&quot;grpc://node1:8815&quot;</span><span class="token" style="color:#a1a1aa">,</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">4</span><span>    </span><span class="token" style="color:#39ff14">&quot;grpc://node2:8816&quot;</span><span class="token" style="color:#a1a1aa">,</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">5</span><span>    </span><span class="token" style="color:#39ff14">&quot;grpc://node3:8817&quot;</span><span class="token" style="color:#a1a1aa">,</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">6</span><span>    </span><span class="token" style="color:#39ff14">&quot;grpc://node4:8818&quot;</span><span class="token" style="color:#a1a1aa">,</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">7</span><span></span><span class="token" style="color:#a1a1aa">]</span><span class="token" style="color:#a1a1aa">)</span></span></code></pre></div></div>
<p class="jsx-fa6f63a6524ee32c paragraph">Each node is an independent Flight server:</p>
<div class="jsx-ae081af0992b9daf pre-wrapper"><div class="jsx-3068834386 code-block"><div class="jsx-3068834386 language-badge">python</div><pre style="color:#e4e4e7;background:#0d0d12;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none;padding:1.5em;margin:0;overflow:auto;border-radius:8px;border:1px solid rgba(0, 240, 255, 0.15);border-top:1px solid rgba(0, 240, 255, 0.15)"><code class="language-python" style="color:#e4e4e7;background:none;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none"><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">1</span><span class="token" style="color:#6b7280"># Start individual nodes</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">2</span><span>node1 </span><span class="token" style="color:#00f0ff">=</span><span> SemanticKVNode</span><span class="token" style="color:#a1a1aa">(</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">3</span><span>    location</span><span class="token" style="color:#00f0ff">=</span><span class="token" style="color:#39ff14">&quot;grpc://0.0.0.0:8815&quot;</span><span class="token" style="color:#a1a1aa">,</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">4</span><span>    node_id</span><span class="token" style="color:#00f0ff">=</span><span class="token" style="color:#39ff14">&quot;node-1&quot;</span><span class="token" style="color:#a1a1aa">,</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">5</span><span>    embedding_provider</span><span class="token" style="color:#00f0ff">=</span><span>SentenceTransformerEmbedding</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">,</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">6</span><span></span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">7</span><span>node1</span><span class="token" style="color:#a1a1aa">.</span><span>serve</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#a1a1aa">)</span><span>  </span><span class="token" style="color:#6b7280"># Blocks, runs gRPC server</span></span></code></pre></div></div>
<h3 id="" class="jsx-9b0a55d81258b172 heading-3">Connection Pooling</h3>
<p class="jsx-fa6f63a6524ee32c paragraph">The client maintains a <strong class="jsx-f6f1f2b90dda302a strong">lazy connection pool</strong> with thread-safe initialization:</p>
<div class="jsx-ae081af0992b9daf pre-wrapper"><div class="jsx-3068834386 code-block"><div class="jsx-3068834386 language-badge">python</div><pre style="color:#e4e4e7;background:#0d0d12;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none;padding:1.5em;margin:0;overflow:auto;border-radius:8px;border:1px solid rgba(0, 240, 255, 0.15);border-top:1px solid rgba(0, 240, 255, 0.15)"><code class="language-python" style="color:#e4e4e7;background:none;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none"><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">1</span><span class="token" style="color:#ff00aa">def</span><span> </span><span class="token" style="color:#bf00ff">_get_client</span><span class="token" style="color:#a1a1aa">(</span><span>self</span><span class="token" style="color:#a1a1aa">,</span><span> node</span><span class="token" style="color:#a1a1aa">:</span><span> </span><span class="token" style="color:#bf00ff">str</span><span class="token" style="color:#a1a1aa">)</span><span> </span><span class="token" style="color:#00f0ff">-</span><span class="token" style="color:#00f0ff">&gt;</span><span> flight</span><span class="token" style="color:#a1a1aa">.</span><span>FlightClient</span><span class="token" style="color:#a1a1aa">:</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">2</span><span>    </span><span class="token" style="color:#ff00aa">with</span><span> self</span><span class="token" style="color:#a1a1aa">.</span><span>_clients_lock</span><span class="token" style="color:#a1a1aa">:</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">3</span><span>        </span><span class="token" style="color:#ff00aa">if</span><span> node </span><span class="token" style="color:#ff00aa">not</span><span> </span><span class="token" style="color:#ff00aa">in</span><span> self</span><span class="token" style="color:#a1a1aa">.</span><span>_clients</span><span class="token" style="color:#a1a1aa">:</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">4</span><span>            self</span><span class="token" style="color:#a1a1aa">.</span><span>_clients</span><span class="token" style="color:#a1a1aa">[</span><span>node</span><span class="token" style="color:#a1a1aa">]</span><span> </span><span class="token" style="color:#00f0ff">=</span><span> flight</span><span class="token" style="color:#a1a1aa">.</span><span>FlightClient</span><span class="token" style="color:#a1a1aa">(</span><span>node</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">5</span><span>        </span><span class="token" style="color:#ff00aa">return</span><span> self</span><span class="token" style="color:#a1a1aa">.</span><span>_clients</span><span class="token" style="color:#a1a1aa">[</span><span>node</span><span class="token" style="color:#a1a1aa">]</span></span></code></pre></div></div>
<h3 id="" class="jsx-9b0a55d81258b172 heading-3">Retry Logic with Backoff</h3>
<p class="jsx-fa6f63a6524ee32c paragraph">Failed operations are retried with exponential backoff:</p>
<div class="jsx-ae081af0992b9daf pre-wrapper"><div class="jsx-3068834386 code-block"><div class="jsx-3068834386 language-badge">python</div><pre style="color:#e4e4e7;background:#0d0d12;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none;padding:1.5em;margin:0;overflow:auto;border-radius:8px;border:1px solid rgba(0, 240, 255, 0.15);border-top:1px solid rgba(0, 240, 255, 0.15)"><code class="language-python" style="color:#e4e4e7;background:none;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none"><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">1</span><span class="token" style="color:#ff00aa">def</span><span> </span><span class="token" style="color:#bf00ff">_execute_with_retry</span><span class="token" style="color:#a1a1aa">(</span><span>self</span><span class="token" style="color:#a1a1aa">,</span><span> node</span><span class="token" style="color:#a1a1aa">,</span><span> action_type</span><span class="token" style="color:#a1a1aa">,</span><span> body</span><span class="token" style="color:#a1a1aa">,</span><span> retries</span><span class="token" style="color:#00f0ff">=</span><span class="token" style="color:#ff6b00">2</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">:</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">2</span><span>    </span><span class="token" style="color:#ff00aa">for</span><span> attempt </span><span class="token" style="color:#ff00aa">in</span><span> </span><span class="token" style="color:#bf00ff">range</span><span class="token" style="color:#a1a1aa">(</span><span>retries </span><span class="token" style="color:#00f0ff">+</span><span> </span><span class="token" style="color:#ff6b00">1</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">:</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">3</span><span>        </span><span class="token" style="color:#ff00aa">try</span><span class="token" style="color:#a1a1aa">:</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">4</span><span>            client </span><span class="token" style="color:#00f0ff">=</span><span> self</span><span class="token" style="color:#a1a1aa">.</span><span>_get_client</span><span class="token" style="color:#a1a1aa">(</span><span>node</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">5</span><span>            action </span><span class="token" style="color:#00f0ff">=</span><span> flight</span><span class="token" style="color:#a1a1aa">.</span><span>Action</span><span class="token" style="color:#a1a1aa">(</span><span>action_type</span><span class="token" style="color:#a1a1aa">,</span><span> body</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">6</span><span>            results </span><span class="token" style="color:#00f0ff">=</span><span> </span><span class="token" style="color:#bf00ff">list</span><span class="token" style="color:#a1a1aa">(</span><span>client</span><span class="token" style="color:#a1a1aa">.</span><span>do_action</span><span class="token" style="color:#a1a1aa">(</span><span>action</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">7</span><span>            </span><span class="token" style="color:#ff00aa">return</span><span> results</span><span class="token" style="color:#a1a1aa">[</span><span class="token" style="color:#ff6b00">0</span><span class="token" style="color:#a1a1aa">]</span><span class="token" style="color:#a1a1aa">.</span><span>body</span><span class="token" style="color:#a1a1aa">.</span><span>to_pybytes</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">8</span><span>        </span><span class="token" style="color:#ff00aa">except</span><span> Exception</span><span class="token" style="color:#a1a1aa">:</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">9</span><span>            </span><span class="token" style="color:#6b7280"># Remove stale connection, backoff, retry</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">10</span><span>            </span><span class="token" style="color:#ff00aa">del</span><span> self</span><span class="token" style="color:#a1a1aa">.</span><span>_clients</span><span class="token" style="color:#a1a1aa">[</span><span>node</span><span class="token" style="color:#a1a1aa">]</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">11</span><span>            time</span><span class="token" style="color:#a1a1aa">.</span><span>sleep</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#ff6b00">0.1</span><span> </span><span class="token" style="color:#00f0ff">*</span><span> </span><span class="token" style="color:#a1a1aa">(</span><span>attempt </span><span class="token" style="color:#00f0ff">+</span><span> </span><span class="token" style="color:#ff6b00">1</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">)</span></span></code></pre></div></div>
<h2 id="" class="jsx-86f38cbe459c25ed heading-2">VII. Query Distribution: Consistent Hashing</h2>
<h3 id="" class="jsx-9b0a55d81258b172 heading-3">How Consistent Hashing Works</h3>
<p class="jsx-fa6f63a6524ee32c paragraph">The system uses <strong class="jsx-f6f1f2b90dda302a strong">consistent hashing with virtual nodes</strong> to distribute keys across the cluster. The implementation uses MD5 hashing:</p>
<div class="jsx-ae081af0992b9daf pre-wrapper"><div class="jsx-3068834386 code-block"><div class="jsx-3068834386 language-badge">python</div><pre style="color:#e4e4e7;background:#0d0d12;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none;padding:1.5em;margin:0;overflow:auto;border-radius:8px;border:1px solid rgba(0, 240, 255, 0.15);border-top:1px solid rgba(0, 240, 255, 0.15)"><code class="language-python" style="color:#e4e4e7;background:none;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none"><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">1</span><span class="token" style="color:#ff00aa">class</span><span> </span><span class="token" style="color:#00f0ff">ConsistentHashRing</span><span class="token" style="color:#a1a1aa">:</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">2</span><span>    </span><span class="token" style="color:#ff00aa">def</span><span> </span><span class="token" style="color:#bf00ff">__init__</span><span class="token" style="color:#a1a1aa">(</span><span>self</span><span class="token" style="color:#a1a1aa">,</span><span> nodes</span><span class="token" style="color:#a1a1aa">:</span><span> List</span><span class="token" style="color:#a1a1aa">[</span><span class="token" style="color:#bf00ff">str</span><span class="token" style="color:#a1a1aa">]</span><span class="token" style="color:#a1a1aa">,</span><span> virtual_nodes</span><span class="token" style="color:#a1a1aa">:</span><span> </span><span class="token" style="color:#bf00ff">int</span><span> </span><span class="token" style="color:#00f0ff">=</span><span> </span><span class="token" style="color:#ff6b00">150</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">:</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">3</span><span>        self</span><span class="token" style="color:#a1a1aa">.</span><span>_virtual_nodes </span><span class="token" style="color:#00f0ff">=</span><span> virtual_nodes
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">4</span><span>        self</span><span class="token" style="color:#a1a1aa">.</span><span>_ring</span><span class="token" style="color:#a1a1aa">:</span><span> List</span><span class="token" style="color:#a1a1aa">[</span><span>Tuple</span><span class="token" style="color:#a1a1aa">[</span><span class="token" style="color:#bf00ff">int</span><span class="token" style="color:#a1a1aa">,</span><span> </span><span class="token" style="color:#bf00ff">str</span><span class="token" style="color:#a1a1aa">]</span><span class="token" style="color:#a1a1aa">]</span><span> </span><span class="token" style="color:#00f0ff">=</span><span> </span><span class="token" style="color:#a1a1aa">[</span><span class="token" style="color:#a1a1aa">]</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">5</span>
</span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">6</span><span>        </span><span class="token" style="color:#ff00aa">for</span><span> node </span><span class="token" style="color:#ff00aa">in</span><span> nodes</span><span class="token" style="color:#a1a1aa">:</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">7</span><span>            self</span><span class="token" style="color:#a1a1aa">.</span><span>add_node</span><span class="token" style="color:#a1a1aa">(</span><span>node</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">8</span>
</span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">9</span><span>    </span><span class="token" style="color:#ff00aa">def</span><span> </span><span class="token" style="color:#bf00ff">_hash</span><span class="token" style="color:#a1a1aa">(</span><span>self</span><span class="token" style="color:#a1a1aa">,</span><span> key</span><span class="token" style="color:#a1a1aa">:</span><span> </span><span class="token" style="color:#bf00ff">str</span><span class="token" style="color:#a1a1aa">)</span><span> </span><span class="token" style="color:#00f0ff">-</span><span class="token" style="color:#00f0ff">&gt;</span><span> </span><span class="token" style="color:#bf00ff">int</span><span class="token" style="color:#a1a1aa">:</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">10</span><span>        </span><span class="token" style="color:#ff00aa">return</span><span> </span><span class="token" style="color:#bf00ff">int</span><span class="token" style="color:#a1a1aa">(</span><span>hashlib</span><span class="token" style="color:#a1a1aa">.</span><span>md5</span><span class="token" style="color:#a1a1aa">(</span><span>key</span><span class="token" style="color:#a1a1aa">.</span><span>encode</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">.</span><span>hexdigest</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">,</span><span> </span><span class="token" style="color:#ff6b00">16</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">11</span>
</span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">12</span><span>    </span><span class="token" style="color:#ff00aa">def</span><span> </span><span class="token" style="color:#bf00ff">add_node</span><span class="token" style="color:#a1a1aa">(</span><span>self</span><span class="token" style="color:#a1a1aa">,</span><span> node</span><span class="token" style="color:#a1a1aa">:</span><span> </span><span class="token" style="color:#bf00ff">str</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">:</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">13</span><span>        </span><span class="token" style="color:#6b7280"># Add virtual nodes for even distribution</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">14</span><span>        </span><span class="token" style="color:#ff00aa">for</span><span> i </span><span class="token" style="color:#ff00aa">in</span><span> </span><span class="token" style="color:#bf00ff">range</span><span class="token" style="color:#a1a1aa">(</span><span>self</span><span class="token" style="color:#a1a1aa">.</span><span>_virtual_nodes</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">:</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">15</span><span>            virtual_key </span><span class="token" style="color:#00f0ff">=</span><span> </span><span class="token string-interpolation" style="color:#39ff14">f&quot;</span><span class="token string-interpolation interpolation" style="color:#a1a1aa">{</span><span class="token string-interpolation interpolation">node</span><span class="token string-interpolation interpolation" style="color:#a1a1aa">}</span><span class="token string-interpolation" style="color:#39ff14">:vnode:</span><span class="token string-interpolation interpolation" style="color:#a1a1aa">{</span><span class="token string-interpolation interpolation">i</span><span class="token string-interpolation interpolation" style="color:#a1a1aa">}</span><span class="token string-interpolation" style="color:#39ff14">&quot;</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">16</span><span>            hash_val </span><span class="token" style="color:#00f0ff">=</span><span> self</span><span class="token" style="color:#a1a1aa">.</span><span>_hash</span><span class="token" style="color:#a1a1aa">(</span><span>virtual_key</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">17</span><span>            self</span><span class="token" style="color:#a1a1aa">.</span><span>_ring</span><span class="token" style="color:#a1a1aa">.</span><span>append</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#a1a1aa">(</span><span>hash_val</span><span class="token" style="color:#a1a1aa">,</span><span> node</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">18</span>
</span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">19</span><span>        </span><span class="token" style="color:#6b7280"># Sort for binary search</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">20</span><span>        self</span><span class="token" style="color:#a1a1aa">.</span><span>_ring</span><span class="token" style="color:#a1a1aa">.</span><span>sort</span><span class="token" style="color:#a1a1aa">(</span><span>key</span><span class="token" style="color:#00f0ff">=</span><span class="token" style="color:#ff00aa">lambda</span><span> x</span><span class="token" style="color:#a1a1aa">:</span><span> x</span><span class="token" style="color:#a1a1aa">[</span><span class="token" style="color:#ff6b00">0</span><span class="token" style="color:#a1a1aa">]</span><span class="token" style="color:#a1a1aa">)</span></span></code></pre></div></div>
<h3 id="" class="jsx-9b0a55d81258b172 heading-3">Virtual Nodes for Even Distribution</h3>
<p class="jsx-fa6f63a6524ee32c paragraph">With 150 virtual nodes per physical node:</p>
<ul class="jsx-95fcca5befc65769 unordered-list">
<li class="jsx-4a0fac569cd62d29 list-item"><strong class="jsx-f6f1f2b90dda302a strong">Even key distribution</strong>: Keys spread uniformly across nodes</li>
<li class="jsx-4a0fac569cd62d29 list-item"><strong class="jsx-f6f1f2b90dda302a strong">Minimal reshuffling</strong>: Adding/removing a node only remaps ~1/N keys</li>
<li class="jsx-4a0fac569cd62d29 list-item"><strong class="jsx-f6f1f2b90dda302a strong">O(log n) lookups</strong>: Binary search on sorted ring</li>
</ul>
<div class="jsx-ae081af0992b9daf pre-wrapper"><div class="jsx-3068834386 code-block"><div class="jsx-3068834386 language-badge">python</div><pre style="color:#e4e4e7;background:#0d0d12;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none;padding:1.5em;margin:0;overflow:auto;border-radius:8px;border:1px solid rgba(0, 240, 255, 0.15);border-top:1px solid rgba(0, 240, 255, 0.15)"><code class="language-python" style="color:#e4e4e7;background:none;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none"><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">1</span><span class="token" style="color:#ff00aa">def</span><span> </span><span class="token" style="color:#bf00ff">get_node</span><span class="token" style="color:#a1a1aa">(</span><span>self</span><span class="token" style="color:#a1a1aa">,</span><span> key</span><span class="token" style="color:#a1a1aa">:</span><span> </span><span class="token" style="color:#bf00ff">str</span><span class="token" style="color:#a1a1aa">)</span><span> </span><span class="token" style="color:#00f0ff">-</span><span class="token" style="color:#00f0ff">&gt;</span><span> </span><span class="token" style="color:#bf00ff">str</span><span class="token" style="color:#a1a1aa">:</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">2</span><span>    hash_val </span><span class="token" style="color:#00f0ff">=</span><span> self</span><span class="token" style="color:#a1a1aa">.</span><span>_hash</span><span class="token" style="color:#a1a1aa">(</span><span>key</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">3</span>
</span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">4</span><span>    </span><span class="token" style="color:#6b7280"># Binary search for first node with hash &gt;= key hash</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">5</span><span>    idx </span><span class="token" style="color:#00f0ff">=</span><span> bisect_right</span><span class="token" style="color:#a1a1aa">(</span><span>self</span><span class="token" style="color:#a1a1aa">.</span><span>_hash_values</span><span class="token" style="color:#a1a1aa">,</span><span> hash_val</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">6</span>
</span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">7</span><span>    </span><span class="token" style="color:#6b7280"># Wrap around if past the end</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">8</span><span>    </span><span class="token" style="color:#ff00aa">if</span><span> idx </span><span class="token" style="color:#00f0ff">&gt;=</span><span> </span><span class="token" style="color:#bf00ff">len</span><span class="token" style="color:#a1a1aa">(</span><span>self</span><span class="token" style="color:#a1a1aa">.</span><span>_ring</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">:</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">9</span><span>        idx </span><span class="token" style="color:#00f0ff">=</span><span> </span><span class="token" style="color:#ff6b00">0</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">10</span>
</span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">11</span><span>    </span><span class="token" style="color:#ff00aa">return</span><span> self</span><span class="token" style="color:#a1a1aa">.</span><span>_ring</span><span class="token" style="color:#a1a1aa">[</span><span>idx</span><span class="token" style="color:#a1a1aa">]</span><span class="token" style="color:#a1a1aa">[</span><span class="token" style="color:#ff6b00">1</span><span class="token" style="color:#a1a1aa">]</span></span></code></pre></div></div>
<h3 id="" class="jsx-9b0a55d81258b172 heading-3">Operation Routing Patterns</h3>
<p class="jsx-fa6f63a6524ee32c paragraph">Different operations use different routing strategies:</p>
<div class="jsx-4c739fccc3d83b4f table-wrapper"><table class="jsx-4c739fccc3d83b4f "><thead style="background:linear-gradient(135deg, #15151f 0%, #1a1a24 100%)"><tr class="jsx-dfe7859156a0174a table-row"><th class="jsx-1b567b89329bb1f9 table-header">Operation</th><th class="jsx-1b567b89329bb1f9 table-header">Strategy</th><th class="jsx-1b567b89329bb1f9 table-header">Description</th></tr></thead><tbody><tr class="jsx-dfe7859156a0174a table-row"><td class="jsx-6d6a9301fcc0bf87 table-cell"><code class="jsx-d03bd386dbbda663 inline-code">put(key, value)</code></td><td class="jsx-6d6a9301fcc0bf87 table-cell"><strong class="jsx-f6f1f2b90dda302a strong">Deterministic</strong></td><td class="jsx-6d6a9301fcc0bf87 table-cell">Hash key -&gt; single responsible node</td></tr><tr class="jsx-dfe7859156a0174a table-row"><td class="jsx-6d6a9301fcc0bf87 table-cell"><code class="jsx-d03bd386dbbda663 inline-code">get(key)</code></td><td class="jsx-6d6a9301fcc0bf87 table-cell"><strong class="jsx-f6f1f2b90dda302a strong">Deterministic</strong></td><td class="jsx-6d6a9301fcc0bf87 table-cell">Hash key -&gt; single responsible node</td></tr><tr class="jsx-dfe7859156a0174a table-row"><td class="jsx-6d6a9301fcc0bf87 table-cell"><code class="jsx-d03bd386dbbda663 inline-code">delete(key)</code></td><td class="jsx-6d6a9301fcc0bf87 table-cell"><strong class="jsx-f6f1f2b90dda302a strong">Deterministic</strong></td><td class="jsx-6d6a9301fcc0bf87 table-cell">Hash key -&gt; single responsible node</td></tr><tr class="jsx-dfe7859156a0174a table-row"><td class="jsx-6d6a9301fcc0bf87 table-cell"><code class="jsx-d03bd386dbbda663 inline-code">search(query)</code></td><td class="jsx-6d6a9301fcc0bf87 table-cell"><strong class="jsx-f6f1f2b90dda302a strong">Scatter-Gather</strong></td><td class="jsx-6d6a9301fcc0bf87 table-cell">Query ALL nodes -&gt; merge by similarity</td></tr><tr class="jsx-dfe7859156a0174a table-row"><td class="jsx-6d6a9301fcc0bf87 table-cell"><code class="jsx-d03bd386dbbda663 inline-code">scan(prefix)</code></td><td class="jsx-6d6a9301fcc0bf87 table-cell"><strong class="jsx-f6f1f2b90dda302a strong">Scatter-Gather</strong></td><td class="jsx-6d6a9301fcc0bf87 table-cell">Query ALL nodes -&gt; deduplicate keys</td></tr></tbody></table></div>
<h3 id="" class="jsx-9b0a55d81258b172 heading-3">PUT: Deterministic Write</h3>
<div class="jsx-ae081af0992b9daf pre-wrapper"><div class="jsx-3068834386 code-block"><div class="jsx-3068834386 language-badge">python</div><pre style="color:#e4e4e7;background:#0d0d12;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none;padding:1.5em;margin:0;overflow:auto;border-radius:8px;border:1px solid rgba(0, 240, 255, 0.15);border-top:1px solid rgba(0, 240, 255, 0.15)"><code class="language-python" style="color:#e4e4e7;background:none;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none"><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">1</span><span class="token" style="color:#ff00aa">def</span><span> </span><span class="token" style="color:#bf00ff">put</span><span class="token" style="color:#a1a1aa">(</span><span>self</span><span class="token" style="color:#a1a1aa">,</span><span> key</span><span class="token" style="color:#a1a1aa">:</span><span> </span><span class="token" style="color:#bf00ff">str</span><span class="token" style="color:#a1a1aa">,</span><span> value</span><span class="token" style="color:#a1a1aa">:</span><span> </span><span class="token" style="color:#bf00ff">bytes</span><span class="token" style="color:#a1a1aa">,</span><span> ttl_ms</span><span class="token" style="color:#a1a1aa">:</span><span> </span><span class="token" style="color:#bf00ff">int</span><span> </span><span class="token" style="color:#00f0ff">=</span><span> </span><span class="token" style="color:#ff6b00">0</span><span class="token" style="color:#a1a1aa">)</span><span> </span><span class="token" style="color:#00f0ff">-</span><span class="token" style="color:#00f0ff">&gt;</span><span> </span><span class="token" style="color:#bf00ff">bool</span><span class="token" style="color:#a1a1aa">:</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">2</span><span>    </span><span class="token" style="color:#6b7280"># Hash determines the single responsible node</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">3</span><span>    node </span><span class="token" style="color:#00f0ff">=</span><span> self</span><span class="token" style="color:#a1a1aa">.</span><span>_ring</span><span class="token" style="color:#a1a1aa">.</span><span>get_node</span><span class="token" style="color:#a1a1aa">(</span><span>key</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">4</span>
</span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">5</span><span>    data </span><span class="token" style="color:#00f0ff">=</span><span> json</span><span class="token" style="color:#a1a1aa">.</span><span>dumps</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#a1a1aa">{</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">6</span><span>        </span><span class="token" style="color:#39ff14">&#x27;key&#x27;</span><span class="token" style="color:#a1a1aa">:</span><span> key</span><span class="token" style="color:#a1a1aa">,</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">7</span><span>        </span><span class="token" style="color:#39ff14">&#x27;value&#x27;</span><span class="token" style="color:#a1a1aa">:</span><span> </span><span class="token" style="color:#bf00ff">list</span><span class="token" style="color:#a1a1aa">(</span><span>value</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">,</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">8</span><span>        </span><span class="token" style="color:#39ff14">&#x27;ttl_ms&#x27;</span><span class="token" style="color:#a1a1aa">:</span><span> ttl_ms
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">9</span><span>    </span><span class="token" style="color:#a1a1aa">}</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">10</span>
</span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">11</span><span>    result </span><span class="token" style="color:#00f0ff">=</span><span> self</span><span class="token" style="color:#a1a1aa">.</span><span>_execute_with_retry</span><span class="token" style="color:#a1a1aa">(</span><span>node</span><span class="token" style="color:#a1a1aa">,</span><span> </span><span class="token" style="color:#39ff14">&quot;put&quot;</span><span class="token" style="color:#a1a1aa">,</span><span> data</span><span class="token" style="color:#a1a1aa">.</span><span>encode</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">12</span><span>    </span><span class="token" style="color:#ff00aa">return</span><span> result </span><span class="token" style="color:#00f0ff">==</span><span> </span><span class="token" style="color:#39ff14">b&quot;ok&quot;</span></span></code></pre></div></div>
<h3 id="" class="jsx-9b0a55d81258b172 heading-3">GET: Deterministic Read</h3>
<div class="jsx-ae081af0992b9daf pre-wrapper"><div class="jsx-3068834386 code-block"><div class="jsx-3068834386 language-badge">python</div><pre style="color:#e4e4e7;background:#0d0d12;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none;padding:1.5em;margin:0;overflow:auto;border-radius:8px;border:1px solid rgba(0, 240, 255, 0.15);border-top:1px solid rgba(0, 240, 255, 0.15)"><code class="language-python" style="color:#e4e4e7;background:none;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none"><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">1</span><span class="token" style="color:#ff00aa">def</span><span> </span><span class="token" style="color:#bf00ff">get</span><span class="token" style="color:#a1a1aa">(</span><span>self</span><span class="token" style="color:#a1a1aa">,</span><span> key</span><span class="token" style="color:#a1a1aa">:</span><span> </span><span class="token" style="color:#bf00ff">str</span><span class="token" style="color:#a1a1aa">)</span><span> </span><span class="token" style="color:#00f0ff">-</span><span class="token" style="color:#00f0ff">&gt;</span><span> Optional</span><span class="token" style="color:#a1a1aa">[</span><span class="token" style="color:#bf00ff">bytes</span><span class="token" style="color:#a1a1aa">]</span><span class="token" style="color:#a1a1aa">:</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">2</span><span>    </span><span class="token" style="color:#6b7280"># Same hash -&gt; same node as PUT</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">3</span><span>    node </span><span class="token" style="color:#00f0ff">=</span><span> self</span><span class="token" style="color:#a1a1aa">.</span><span>_ring</span><span class="token" style="color:#a1a1aa">.</span><span>get_node</span><span class="token" style="color:#a1a1aa">(</span><span>key</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">4</span>
</span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">5</span><span>    result </span><span class="token" style="color:#00f0ff">=</span><span> self</span><span class="token" style="color:#a1a1aa">.</span><span>_execute_with_retry</span><span class="token" style="color:#a1a1aa">(</span><span>node</span><span class="token" style="color:#a1a1aa">,</span><span> </span><span class="token" style="color:#39ff14">&quot;get&quot;</span><span class="token" style="color:#a1a1aa">,</span><span> key</span><span class="token" style="color:#a1a1aa">.</span><span>encode</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">6</span><span>    </span><span class="token" style="color:#ff00aa">return</span><span> result </span><span class="token" style="color:#ff00aa">if</span><span> result </span><span class="token" style="color:#ff00aa">else</span><span> </span><span class="token" style="color:#ff6b00">None</span></span></code></pre></div></div>
<h3 id="" class="jsx-9b0a55d81258b172 heading-3">SEARCH: Scatter-Gather</h3>
<p class="jsx-fa6f63a6524ee32c paragraph">Semantic search <strong class="jsx-f6f1f2b90dda302a strong">must query all nodes</strong> because similar items may be distributed anywhere:</p>
<div class="jsx-ae081af0992b9daf pre-wrapper"><div class="jsx-3068834386 code-block"><div class="jsx-3068834386 language-badge">python</div><pre style="color:#e4e4e7;background:#0d0d12;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none;padding:1.5em;margin:0;overflow:auto;border-radius:8px;border:1px solid rgba(0, 240, 255, 0.15);border-top:1px solid rgba(0, 240, 255, 0.15)"><code class="language-python" style="color:#e4e4e7;background:none;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none"><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">1</span><span class="token" style="color:#ff00aa">def</span><span> </span><span class="token" style="color:#bf00ff">search</span><span class="token" style="color:#a1a1aa">(</span><span>self</span><span class="token" style="color:#a1a1aa">,</span><span> query</span><span class="token" style="color:#a1a1aa">:</span><span> </span><span class="token" style="color:#bf00ff">str</span><span class="token" style="color:#a1a1aa">,</span><span> top_k</span><span class="token" style="color:#a1a1aa">:</span><span> </span><span class="token" style="color:#bf00ff">int</span><span> </span><span class="token" style="color:#00f0ff">=</span><span> </span><span class="token" style="color:#ff6b00">10</span><span class="token" style="color:#a1a1aa">,</span><span> threshold</span><span class="token" style="color:#a1a1aa">:</span><span> </span><span class="token" style="color:#bf00ff">float</span><span> </span><span class="token" style="color:#00f0ff">=</span><span> </span><span class="token" style="color:#ff6b00">0.7</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">:</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">2</span><span>    params </span><span class="token" style="color:#00f0ff">=</span><span> json</span><span class="token" style="color:#a1a1aa">.</span><span>dumps</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#a1a1aa">{</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">3</span><span>        </span><span class="token" style="color:#39ff14">&#x27;query&#x27;</span><span class="token" style="color:#a1a1aa">:</span><span> query</span><span class="token" style="color:#a1a1aa">,</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">4</span><span>        </span><span class="token" style="color:#39ff14">&#x27;top_k&#x27;</span><span class="token" style="color:#a1a1aa">:</span><span> top_k</span><span class="token" style="color:#a1a1aa">,</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">5</span><span>        </span><span class="token" style="color:#39ff14">&#x27;threshold&#x27;</span><span class="token" style="color:#a1a1aa">:</span><span> threshold
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">6</span><span>    </span><span class="token" style="color:#a1a1aa">}</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">7</span>
</span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">8</span><span>    </span><span class="token" style="color:#ff00aa">def</span><span> </span><span class="token" style="color:#bf00ff">search_node</span><span class="token" style="color:#a1a1aa">(</span><span>node</span><span class="token" style="color:#a1a1aa">:</span><span> </span><span class="token" style="color:#bf00ff">str</span><span class="token" style="color:#a1a1aa">)</span><span> </span><span class="token" style="color:#00f0ff">-</span><span class="token" style="color:#00f0ff">&gt;</span><span> List</span><span class="token" style="color:#a1a1aa">[</span><span class="token" style="color:#bf00ff">dict</span><span class="token" style="color:#a1a1aa">]</span><span class="token" style="color:#a1a1aa">:</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">9</span><span>        result </span><span class="token" style="color:#00f0ff">=</span><span> self</span><span class="token" style="color:#a1a1aa">.</span><span>_execute_with_retry</span><span class="token" style="color:#a1a1aa">(</span><span>node</span><span class="token" style="color:#a1a1aa">,</span><span> </span><span class="token" style="color:#39ff14">&quot;search_local&quot;</span><span class="token" style="color:#a1a1aa">,</span><span> params</span><span class="token" style="color:#a1a1aa">.</span><span>encode</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">10</span><span>        </span><span class="token" style="color:#ff00aa">return</span><span> json</span><span class="token" style="color:#a1a1aa">.</span><span>loads</span><span class="token" style="color:#a1a1aa">(</span><span>result</span><span class="token" style="color:#a1a1aa">.</span><span>decode</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">)</span><span> </span><span class="token" style="color:#ff00aa">if</span><span> result </span><span class="token" style="color:#ff00aa">else</span><span> </span><span class="token" style="color:#a1a1aa">[</span><span class="token" style="color:#a1a1aa">]</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">11</span>
</span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">12</span><span>    </span><span class="token" style="color:#6b7280"># SCATTER: Query all nodes in parallel</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">13</span><span>    all_nodes </span><span class="token" style="color:#00f0ff">=</span><span> self</span><span class="token" style="color:#a1a1aa">.</span><span>_ring</span><span class="token" style="color:#a1a1aa">.</span><span>get_all_nodes</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">14</span><span>    futures </span><span class="token" style="color:#00f0ff">=</span><span> </span><span class="token" style="color:#a1a1aa">{</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">15</span><span>        self</span><span class="token" style="color:#a1a1aa">.</span><span>_executor</span><span class="token" style="color:#a1a1aa">.</span><span>submit</span><span class="token" style="color:#a1a1aa">(</span><span>search_node</span><span class="token" style="color:#a1a1aa">,</span><span> node</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">:</span><span> node
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">16</span><span>        </span><span class="token" style="color:#ff00aa">for</span><span> node </span><span class="token" style="color:#ff00aa">in</span><span> all_nodes
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">17</span><span>    </span><span class="token" style="color:#a1a1aa">}</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">18</span>
</span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">19</span><span>    </span><span class="token" style="color:#6b7280"># GATHER: Collect results with timeout</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">20</span><span>    all_results </span><span class="token" style="color:#00f0ff">=</span><span> </span><span class="token" style="color:#a1a1aa">[</span><span class="token" style="color:#a1a1aa">]</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">21</span><span>    </span><span class="token" style="color:#ff00aa">for</span><span> future </span><span class="token" style="color:#ff00aa">in</span><span> as_completed</span><span class="token" style="color:#a1a1aa">(</span><span>futures</span><span class="token" style="color:#a1a1aa">,</span><span> timeout</span><span class="token" style="color:#00f0ff">=</span><span>self</span><span class="token" style="color:#a1a1aa">.</span><span>_search_timeout</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">:</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">22</span><span>        node_results </span><span class="token" style="color:#00f0ff">=</span><span> future</span><span class="token" style="color:#a1a1aa">.</span><span>result</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">23</span><span>        all_results</span><span class="token" style="color:#a1a1aa">.</span><span>extend</span><span class="token" style="color:#a1a1aa">(</span><span>node_results</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">24</span>
</span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">25</span><span>    </span><span class="token" style="color:#6b7280"># MERGE: Sort by similarity, return top-k</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">26</span><span>    all_results</span><span class="token" style="color:#a1a1aa">.</span><span>sort</span><span class="token" style="color:#a1a1aa">(</span><span>key</span><span class="token" style="color:#00f0ff">=</span><span class="token" style="color:#ff00aa">lambda</span><span> x</span><span class="token" style="color:#a1a1aa">:</span><span> x</span><span class="token" style="color:#a1a1aa">[</span><span class="token" style="color:#39ff14">&#x27;similarity&#x27;</span><span class="token" style="color:#a1a1aa">]</span><span class="token" style="color:#a1a1aa">,</span><span> reverse</span><span class="token" style="color:#00f0ff">=</span><span class="token" style="color:#ff6b00">True</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">27</span><span>    </span><span class="token" style="color:#ff00aa">return</span><span> all_results</span><span class="token" style="color:#a1a1aa">[</span><span class="token" style="color:#a1a1aa">:</span><span>top_k</span><span class="token" style="color:#a1a1aa">]</span></span></code></pre></div></div>
<p class="jsx-fa6f63a6524ee32c paragraph">The thread pool uses <code class="jsx-d03bd386dbbda663 inline-code">nodes * 2</code> workers by default for parallel operations:</p>
<div class="jsx-ae081af0992b9daf pre-wrapper"><div class="jsx-3068834386 code-block"><div class="jsx-3068834386 language-badge">python</div><pre style="color:#e4e4e7;background:#0d0d12;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none;padding:1.5em;margin:0;overflow:auto;border-radius:8px;border:1px solid rgba(0, 240, 255, 0.15);border-top:1px solid rgba(0, 240, 255, 0.15)"><code class="language-python" style="color:#e4e4e7;background:none;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none"><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">1</span><span>self</span><span class="token" style="color:#a1a1aa">.</span><span>_executor </span><span class="token" style="color:#00f0ff">=</span><span> ThreadPoolExecutor</span><span class="token" style="color:#a1a1aa">(</span><span>max_workers</span><span class="token" style="color:#00f0ff">=</span><span class="token" style="color:#bf00ff">len</span><span class="token" style="color:#a1a1aa">(</span><span>nodes</span><span class="token" style="color:#a1a1aa">)</span><span> </span><span class="token" style="color:#00f0ff">*</span><span> </span><span class="token" style="color:#ff6b00">2</span><span class="token" style="color:#a1a1aa">)</span></span></code></pre></div></div>
<h2 id="" class="jsx-86f38cbe459c25ed heading-2">VIII. Vector Indexing with HNSW</h2>
<h3 id="" class="jsx-9b0a55d81258b172 heading-3">HNSW Algorithm</h3>
<p class="jsx-fa6f63a6524ee32c paragraph"><strong class="jsx-f6f1f2b90dda302a strong">HNSW (Hierarchical Navigable Small World)</strong> is a state-of-the-art algorithm for approximate nearest neighbor search:</p>
<div class="jsx-ae081af0992b9daf pre-wrapper"><div class="jsx-3068834386 code-block"><div class="jsx-3068834386 language-badge">python</div><pre style="color:#e4e4e7;background:#0d0d12;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none;padding:1.5em;margin:0;overflow:auto;border-radius:8px;border:1px solid rgba(0, 240, 255, 0.15);border-top:1px solid rgba(0, 240, 255, 0.15)"><code class="language-python" style="color:#e4e4e7;background:none;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none"><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">1</span><span>self</span><span class="token" style="color:#a1a1aa">.</span><span>_index </span><span class="token" style="color:#00f0ff">=</span><span> create_vector_index</span><span class="token" style="color:#a1a1aa">(</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">2</span><span>    dim</span><span class="token" style="color:#00f0ff">=</span><span>self</span><span class="token" style="color:#a1a1aa">.</span><span>_embedding_provider</span><span class="token" style="color:#a1a1aa">.</span><span>dimension</span><span class="token" style="color:#a1a1aa">,</span><span>  </span><span class="token" style="color:#6b7280"># 384-3072</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">3</span><span>    max_elements</span><span class="token" style="color:#00f0ff">=</span><span>max_entries</span><span class="token" style="color:#a1a1aa">,</span><span>                 </span><span class="token" style="color:#6b7280"># 100,000 default</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">4</span><span>    ef_construction</span><span class="token" style="color:#00f0ff">=</span><span class="token" style="color:#ff6b00">200</span><span class="token" style="color:#a1a1aa">,</span><span>                      </span><span class="token" style="color:#6b7280"># Build quality</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">5</span><span>    M</span><span class="token" style="color:#00f0ff">=</span><span class="token" style="color:#ff6b00">16</span><span class="token" style="color:#a1a1aa">,</span><span>                                     </span><span class="token" style="color:#6b7280"># Connections per node</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">6</span><span>    ef_search</span><span class="token" style="color:#00f0ff">=</span><span class="token" style="color:#ff6b00">50</span><span>                              </span><span class="token" style="color:#6b7280"># Search quality</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">7</span><span></span><span class="token" style="color:#a1a1aa">)</span></span></code></pre></div></div>
<h3 id="" class="jsx-9b0a55d81258b172 heading-3">Index Operations</h3>
<p class="jsx-fa6f63a6524ee32c paragraph">Each node maintains its own HNSW index with bidirectional mappings:</p>
<div class="jsx-ae081af0992b9daf pre-wrapper"><div class="jsx-3068834386 code-block"><div class="jsx-3068834386 language-badge">python</div><pre style="color:#e4e4e7;background:#0d0d12;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none;padding:1.5em;margin:0;overflow:auto;border-radius:8px;border:1px solid rgba(0, 240, 255, 0.15);border-top:1px solid rgba(0, 240, 255, 0.15)"><code class="language-python" style="color:#e4e4e7;background:none;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none"><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">1</span><span class="token" style="color:#6b7280"># Mappings between keys and index positions</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">2</span><span>self</span><span class="token" style="color:#a1a1aa">.</span><span>_key_to_idx</span><span class="token" style="color:#a1a1aa">:</span><span> Dict</span><span class="token" style="color:#a1a1aa">[</span><span class="token" style="color:#bf00ff">str</span><span class="token" style="color:#a1a1aa">,</span><span> </span><span class="token" style="color:#bf00ff">int</span><span class="token" style="color:#a1a1aa">]</span><span> </span><span class="token" style="color:#00f0ff">=</span><span> </span><span class="token" style="color:#a1a1aa">{</span><span class="token" style="color:#a1a1aa">}</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">3</span><span>self</span><span class="token" style="color:#a1a1aa">.</span><span>_idx_to_key</span><span class="token" style="color:#a1a1aa">:</span><span> Dict</span><span class="token" style="color:#a1a1aa">[</span><span class="token" style="color:#bf00ff">int</span><span class="token" style="color:#a1a1aa">,</span><span> </span><span class="token" style="color:#bf00ff">str</span><span class="token" style="color:#a1a1aa">]</span><span> </span><span class="token" style="color:#00f0ff">=</span><span> </span><span class="token" style="color:#a1a1aa">{</span><span class="token" style="color:#a1a1aa">}</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">4</span><span>self</span><span class="token" style="color:#a1a1aa">.</span><span>_next_idx </span><span class="token" style="color:#00f0ff">=</span><span> </span><span class="token" style="color:#ff6b00">0</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">5</span>
</span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">6</span><span></span><span class="token" style="color:#6b7280"># Adding to index during PUT</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">7</span><span>idx </span><span class="token" style="color:#00f0ff">=</span><span> self</span><span class="token" style="color:#a1a1aa">.</span><span>_next_idx
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">8</span><span>self</span><span class="token" style="color:#a1a1aa">.</span><span>_index</span><span class="token" style="color:#a1a1aa">.</span><span>add_items</span><span class="token" style="color:#a1a1aa">(</span><span>embedding</span><span class="token" style="color:#a1a1aa">.</span><span>reshape</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#ff6b00">1</span><span class="token" style="color:#a1a1aa">,</span><span> </span><span class="token" style="color:#00f0ff">-</span><span class="token" style="color:#ff6b00">1</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">,</span><span> </span><span class="token" style="color:#a1a1aa">[</span><span>idx</span><span class="token" style="color:#a1a1aa">]</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">9</span><span>self</span><span class="token" style="color:#a1a1aa">.</span><span>_key_to_idx</span><span class="token" style="color:#a1a1aa">[</span><span>key</span><span class="token" style="color:#a1a1aa">]</span><span> </span><span class="token" style="color:#00f0ff">=</span><span> idx
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">10</span><span>self</span><span class="token" style="color:#a1a1aa">.</span><span>_idx_to_key</span><span class="token" style="color:#a1a1aa">[</span><span>idx</span><span class="token" style="color:#a1a1aa">]</span><span> </span><span class="token" style="color:#00f0ff">=</span><span> key
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">11</span><span>self</span><span class="token" style="color:#a1a1aa">.</span><span>_next_idx </span><span class="token" style="color:#00f0ff">+=</span><span> </span><span class="token" style="color:#ff6b00">1</span></span></code></pre></div></div>
<h3 id="" class="jsx-9b0a55d81258b172 heading-3">Local Semantic Search</h3>
<div class="jsx-ae081af0992b9daf pre-wrapper"><div class="jsx-3068834386 code-block"><div class="jsx-3068834386 language-badge">python</div><pre style="color:#e4e4e7;background:#0d0d12;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none;padding:1.5em;margin:0;overflow:auto;border-radius:8px;border:1px solid rgba(0, 240, 255, 0.15);border-top:1px solid rgba(0, 240, 255, 0.15)"><code class="language-python" style="color:#e4e4e7;background:none;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none"><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">1</span><span class="token" style="color:#ff00aa">def</span><span> </span><span class="token" style="color:#bf00ff">_action_search_local</span><span class="token" style="color:#a1a1aa">(</span><span>self</span><span class="token" style="color:#a1a1aa">,</span><span> body</span><span class="token" style="color:#a1a1aa">:</span><span> </span><span class="token" style="color:#bf00ff">bytes</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">:</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">2</span><span>    params </span><span class="token" style="color:#00f0ff">=</span><span> json</span><span class="token" style="color:#a1a1aa">.</span><span>loads</span><span class="token" style="color:#a1a1aa">(</span><span>body</span><span class="token" style="color:#a1a1aa">.</span><span>decode</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">3</span><span>    query </span><span class="token" style="color:#00f0ff">=</span><span> params</span><span class="token" style="color:#a1a1aa">[</span><span class="token" style="color:#39ff14">&#x27;query&#x27;</span><span class="token" style="color:#a1a1aa">]</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">4</span><span>    top_k </span><span class="token" style="color:#00f0ff">=</span><span> params</span><span class="token" style="color:#a1a1aa">.</span><span>get</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#39ff14">&#x27;top_k&#x27;</span><span class="token" style="color:#a1a1aa">,</span><span> </span><span class="token" style="color:#ff6b00">10</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">5</span><span>    threshold </span><span class="token" style="color:#00f0ff">=</span><span> params</span><span class="token" style="color:#a1a1aa">.</span><span>get</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#39ff14">&#x27;threshold&#x27;</span><span class="token" style="color:#a1a1aa">,</span><span> </span><span class="token" style="color:#ff6b00">0.7</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">6</span>
</span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">7</span><span>    </span><span class="token" style="color:#6b7280"># Generate query embedding</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">8</span><span>    query_embedding </span><span class="token" style="color:#00f0ff">=</span><span> self</span><span class="token" style="color:#a1a1aa">.</span><span>_get_embedding</span><span class="token" style="color:#a1a1aa">(</span><span>query</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">9</span>
</span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">10</span><span>    </span><span class="token" style="color:#6b7280"># Search HNSW index</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">11</span><span>    k </span><span class="token" style="color:#00f0ff">=</span><span> </span><span class="token" style="color:#bf00ff">min</span><span class="token" style="color:#a1a1aa">(</span><span>top_k</span><span class="token" style="color:#a1a1aa">,</span><span> self</span><span class="token" style="color:#a1a1aa">.</span><span>_index</span><span class="token" style="color:#a1a1aa">.</span><span>get_current_count</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">12</span><span>    labels</span><span class="token" style="color:#a1a1aa">,</span><span> distances </span><span class="token" style="color:#00f0ff">=</span><span> self</span><span class="token" style="color:#a1a1aa">.</span><span>_index</span><span class="token" style="color:#a1a1aa">.</span><span>knn_query</span><span class="token" style="color:#a1a1aa">(</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">13</span><span>        query_embedding</span><span class="token" style="color:#a1a1aa">.</span><span>reshape</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#ff6b00">1</span><span class="token" style="color:#a1a1aa">,</span><span> </span><span class="token" style="color:#00f0ff">-</span><span class="token" style="color:#ff6b00">1</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">,</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">14</span><span>        k</span><span class="token" style="color:#00f0ff">=</span><span>k
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">15</span><span>    </span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">16</span>
</span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">17</span><span>    results </span><span class="token" style="color:#00f0ff">=</span><span> </span><span class="token" style="color:#a1a1aa">[</span><span class="token" style="color:#a1a1aa">]</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">18</span><span>    </span><span class="token" style="color:#ff00aa">for</span><span> label</span><span class="token" style="color:#a1a1aa">,</span><span> dist </span><span class="token" style="color:#ff00aa">in</span><span> </span><span class="token" style="color:#bf00ff">zip</span><span class="token" style="color:#a1a1aa">(</span><span>labels</span><span class="token" style="color:#a1a1aa">[</span><span class="token" style="color:#ff6b00">0</span><span class="token" style="color:#a1a1aa">]</span><span class="token" style="color:#a1a1aa">,</span><span> distances</span><span class="token" style="color:#a1a1aa">[</span><span class="token" style="color:#ff6b00">0</span><span class="token" style="color:#a1a1aa">]</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">:</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">19</span><span>        </span><span class="token" style="color:#6b7280"># Cosine distance to similarity</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">20</span><span>        similarity </span><span class="token" style="color:#00f0ff">=</span><span> </span><span class="token" style="color:#ff6b00">1.0</span><span> </span><span class="token" style="color:#00f0ff">-</span><span> dist
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">21</span>
</span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">22</span><span>        </span><span class="token" style="color:#ff00aa">if</span><span> similarity </span><span class="token" style="color:#00f0ff">&gt;=</span><span> threshold</span><span class="token" style="color:#a1a1aa">:</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">23</span><span>            key </span><span class="token" style="color:#00f0ff">=</span><span> self</span><span class="token" style="color:#a1a1aa">.</span><span>_idx_to_key</span><span class="token" style="color:#a1a1aa">[</span><span>label</span><span class="token" style="color:#a1a1aa">]</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">24</span><span>            entry </span><span class="token" style="color:#00f0ff">=</span><span> self</span><span class="token" style="color:#a1a1aa">.</span><span>_store</span><span class="token" style="color:#a1a1aa">[</span><span>key</span><span class="token" style="color:#a1a1aa">]</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">25</span>
</span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">26</span><span>            results</span><span class="token" style="color:#a1a1aa">.</span><span>append</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#a1a1aa">{</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">27</span><span>                </span><span class="token" style="color:#39ff14">&#x27;key&#x27;</span><span class="token" style="color:#a1a1aa">:</span><span> key</span><span class="token" style="color:#a1a1aa">,</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">28</span><span>                </span><span class="token" style="color:#39ff14">&#x27;value&#x27;</span><span class="token" style="color:#a1a1aa">:</span><span> entry</span><span class="token" style="color:#a1a1aa">.</span><span>value</span><span class="token" style="color:#a1a1aa">.</span><span>decode</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">,</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">29</span><span>                </span><span class="token" style="color:#39ff14">&#x27;similarity&#x27;</span><span class="token" style="color:#a1a1aa">:</span><span> </span><span class="token" style="color:#bf00ff">float</span><span class="token" style="color:#a1a1aa">(</span><span>similarity</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">,</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">30</span><span>                </span><span class="token" style="color:#39ff14">&#x27;node&#x27;</span><span class="token" style="color:#a1a1aa">:</span><span> self</span><span class="token" style="color:#a1a1aa">.</span><span>node_id
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">31</span><span>            </span><span class="token" style="color:#a1a1aa">}</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">32</span>
</span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">33</span><span>    </span><span class="token" style="color:#ff00aa">return</span><span> </span><span class="token" style="color:#a1a1aa">[</span><span>flight</span><span class="token" style="color:#a1a1aa">.</span><span>Result</span><span class="token" style="color:#a1a1aa">(</span><span>json</span><span class="token" style="color:#a1a1aa">.</span><span>dumps</span><span class="token" style="color:#a1a1aa">(</span><span>results</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">.</span><span>encode</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">]</span></span></code></pre></div></div>
<h2 id="" class="jsx-86f38cbe459c25ed heading-2">IX. Embedding Providers</h2>
<p class="jsx-fa6f63a6524ee32c paragraph">Three embedding backends are supported:</p>
<h3 id="" class="jsx-9b0a55d81258b172 heading-3">SentenceTransformers (Recommended)</h3>
<div class="jsx-ae081af0992b9daf pre-wrapper"><div class="jsx-3068834386 code-block"><div class="jsx-3068834386 language-badge">python</div><pre style="color:#e4e4e7;background:#0d0d12;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none;padding:1.5em;margin:0;overflow:auto;border-radius:8px;border:1px solid rgba(0, 240, 255, 0.15);border-top:1px solid rgba(0, 240, 255, 0.15)"><code class="language-python" style="color:#e4e4e7;background:none;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none"><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">1</span><span class="token" style="color:#ff00aa">from</span><span> sentence_transformers </span><span class="token" style="color:#ff00aa">import</span><span> SentenceTransformer
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">2</span>
</span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">3</span><span></span><span class="token" style="color:#ff00aa">class</span><span> </span><span class="token" style="color:#00f0ff">SentenceTransformerEmbedding</span><span class="token" style="color:#a1a1aa">:</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">4</span><span>    </span><span class="token" style="color:#ff00aa">def</span><span> </span><span class="token" style="color:#bf00ff">__init__</span><span class="token" style="color:#a1a1aa">(</span><span>self</span><span class="token" style="color:#a1a1aa">,</span><span> model_name</span><span class="token" style="color:#00f0ff">=</span><span class="token" style="color:#39ff14">&quot;all-MiniLM-L6-v2&quot;</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">:</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">5</span><span>        self</span><span class="token" style="color:#a1a1aa">.</span><span>model </span><span class="token" style="color:#00f0ff">=</span><span> SentenceTransformer</span><span class="token" style="color:#a1a1aa">(</span><span>model_name</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">6</span><span>        self</span><span class="token" style="color:#a1a1aa">.</span><span>dimension </span><span class="token" style="color:#00f0ff">=</span><span> self</span><span class="token" style="color:#a1a1aa">.</span><span>model</span><span class="token" style="color:#a1a1aa">.</span><span>get_sentence_embedding_dimension</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">7</span>
</span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">8</span><span>    </span><span class="token" style="color:#ff00aa">def</span><span> </span><span class="token" style="color:#bf00ff">embed</span><span class="token" style="color:#a1a1aa">(</span><span>self</span><span class="token" style="color:#a1a1aa">,</span><span> text</span><span class="token" style="color:#a1a1aa">:</span><span> </span><span class="token" style="color:#bf00ff">str</span><span class="token" style="color:#a1a1aa">)</span><span> </span><span class="token" style="color:#00f0ff">-</span><span class="token" style="color:#00f0ff">&gt;</span><span> np</span><span class="token" style="color:#a1a1aa">.</span><span>ndarray</span><span class="token" style="color:#a1a1aa">:</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">9</span><span>        </span><span class="token" style="color:#ff00aa">return</span><span> self</span><span class="token" style="color:#a1a1aa">.</span><span>model</span><span class="token" style="color:#a1a1aa">.</span><span>encode</span><span class="token" style="color:#a1a1aa">(</span><span>text</span><span class="token" style="color:#a1a1aa">,</span><span> convert_to_numpy</span><span class="token" style="color:#00f0ff">=</span><span class="token" style="color:#ff6b00">True</span><span class="token" style="color:#a1a1aa">)</span></span></code></pre></div></div>
<h3 id="" class="jsx-9b0a55d81258b172 heading-3">OpenAI Embeddings (Premium)</h3>
<div class="jsx-ae081af0992b9daf pre-wrapper"><div class="jsx-3068834386 code-block"><div class="jsx-3068834386 language-badge">python</div><pre style="color:#e4e4e7;background:#0d0d12;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none;padding:1.5em;margin:0;overflow:auto;border-radius:8px;border:1px solid rgba(0, 240, 255, 0.15);border-top:1px solid rgba(0, 240, 255, 0.15)"><code class="language-python" style="color:#e4e4e7;background:none;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none"><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">1</span><span class="token" style="color:#ff00aa">import</span><span> openai
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">2</span>
</span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">3</span><span></span><span class="token" style="color:#ff00aa">class</span><span> </span><span class="token" style="color:#00f0ff">OpenAIEmbedding</span><span class="token" style="color:#a1a1aa">:</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">4</span><span>    </span><span class="token" style="color:#ff00aa">def</span><span> </span><span class="token" style="color:#bf00ff">__init__</span><span class="token" style="color:#a1a1aa">(</span><span>self</span><span class="token" style="color:#a1a1aa">,</span><span> model</span><span class="token" style="color:#00f0ff">=</span><span class="token" style="color:#39ff14">&quot;text-embedding-3-small&quot;</span><span class="token" style="color:#a1a1aa">)</span><span class="token" style="color:#a1a1aa">:</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">5</span><span>        self</span><span class="token" style="color:#a1a1aa">.</span><span>client </span><span class="token" style="color:#00f0ff">=</span><span> openai</span><span class="token" style="color:#a1a1aa">.</span><span>OpenAI</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">6</span><span>        self</span><span class="token" style="color:#a1a1aa">.</span><span>model </span><span class="token" style="color:#00f0ff">=</span><span> model
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">7</span>
</span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">8</span><span>    </span><span class="token" style="color:#ff00aa">def</span><span> </span><span class="token" style="color:#bf00ff">embed</span><span class="token" style="color:#a1a1aa">(</span><span>self</span><span class="token" style="color:#a1a1aa">,</span><span> text</span><span class="token" style="color:#a1a1aa">:</span><span> </span><span class="token" style="color:#bf00ff">str</span><span class="token" style="color:#a1a1aa">)</span><span> </span><span class="token" style="color:#00f0ff">-</span><span class="token" style="color:#00f0ff">&gt;</span><span> np</span><span class="token" style="color:#a1a1aa">.</span><span>ndarray</span><span class="token" style="color:#a1a1aa">:</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">9</span><span>        response </span><span class="token" style="color:#00f0ff">=</span><span> self</span><span class="token" style="color:#a1a1aa">.</span><span>client</span><span class="token" style="color:#a1a1aa">.</span><span>embeddings</span><span class="token" style="color:#a1a1aa">.</span><span>create</span><span class="token" style="color:#a1a1aa">(</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">10</span><span>            </span><span class="token" style="color:#bf00ff">input</span><span class="token" style="color:#00f0ff">=</span><span>text</span><span class="token" style="color:#a1a1aa">,</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">11</span><span>            model</span><span class="token" style="color:#00f0ff">=</span><span>self</span><span class="token" style="color:#a1a1aa">.</span><span>model
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">12</span><span>        </span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">13</span><span>        </span><span class="token" style="color:#ff00aa">return</span><span> np</span><span class="token" style="color:#a1a1aa">.</span><span>array</span><span class="token" style="color:#a1a1aa">(</span><span>response</span><span class="token" style="color:#a1a1aa">.</span><span>data</span><span class="token" style="color:#a1a1aa">[</span><span class="token" style="color:#ff6b00">0</span><span class="token" style="color:#a1a1aa">]</span><span class="token" style="color:#a1a1aa">.</span><span>embedding</span><span class="token" style="color:#a1a1aa">)</span></span></code></pre></div></div>
<h2 id="" class="jsx-86f38cbe459c25ed heading-2">X. Performance Characteristics</h2>
<p class="jsx-fa6f63a6524ee32c paragraph">Benchmarked on a 4-node localhost cluster:</p>
<div class="jsx-4c739fccc3d83b4f table-wrapper"><table class="jsx-4c739fccc3d83b4f "><thead style="background:linear-gradient(135deg, #15151f 0%, #1a1a24 100%)"><tr class="jsx-dfe7859156a0174a table-row"><th class="jsx-1b567b89329bb1f9 table-header">Operation</th><th class="jsx-1b567b89329bb1f9 table-header">Throughput</th><th class="jsx-1b567b89329bb1f9 table-header">Avg Latency</th><th class="jsx-1b567b89329bb1f9 table-header">P99 Latency</th></tr></thead><tbody><tr class="jsx-dfe7859156a0174a table-row"><td class="jsx-6d6a9301fcc0bf87 table-cell">GET (hit)</td><td class="jsx-6d6a9301fcc0bf87 table-cell">7,195 ops/sec</td><td class="jsx-6d6a9301fcc0bf87 table-cell">0.14 ms</td><td class="jsx-6d6a9301fcc0bf87 table-cell">0.18 ms</td></tr><tr class="jsx-dfe7859156a0174a table-row"><td class="jsx-6d6a9301fcc0bf87 table-cell">GET (miss)</td><td class="jsx-6d6a9301fcc0bf87 table-cell">6,288 ops/sec</td><td class="jsx-6d6a9301fcc0bf87 table-cell">0.16 ms</td><td class="jsx-6d6a9301fcc0bf87 table-cell">0.62 ms</td></tr><tr class="jsx-dfe7859156a0174a table-row"><td class="jsx-6d6a9301fcc0bf87 table-cell">PUT (100B)</td><td class="jsx-6d6a9301fcc0bf87 table-cell">3,579 ops/sec</td><td class="jsx-6d6a9301fcc0bf87 table-cell">0.28 ms</td><td class="jsx-6d6a9301fcc0bf87 table-cell">0.43 ms</td></tr><tr class="jsx-dfe7859156a0174a table-row"><td class="jsx-6d6a9301fcc0bf87 table-cell">PUT (1KB)</td><td class="jsx-6d6a9301fcc0bf87 table-cell">2,721 ops/sec</td><td class="jsx-6d6a9301fcc0bf87 table-cell">0.37 ms</td><td class="jsx-6d6a9301fcc0bf87 table-cell">0.46 ms</td></tr><tr class="jsx-dfe7859156a0174a table-row"><td class="jsx-6d6a9301fcc0bf87 table-cell">DELETE</td><td class="jsx-6d6a9301fcc0bf87 table-cell">7,100 ops/sec</td><td class="jsx-6d6a9301fcc0bf87 table-cell">0.14 ms</td><td class="jsx-6d6a9301fcc0bf87 table-cell">0.20 ms</td></tr><tr class="jsx-dfe7859156a0174a table-row"><td class="jsx-6d6a9301fcc0bf87 table-cell">SEARCH (1K keys)</td><td class="jsx-6d6a9301fcc0bf87 table-cell">344 ops/sec</td><td class="jsx-6d6a9301fcc0bf87 table-cell">2.91 ms</td><td class="jsx-6d6a9301fcc0bf87 table-cell">3.37 ms</td></tr><tr class="jsx-dfe7859156a0174a table-row"><td class="jsx-6d6a9301fcc0bf87 table-cell">SEARCH (10K keys)</td><td class="jsx-6d6a9301fcc0bf87 table-cell">46 ops/sec</td><td class="jsx-6d6a9301fcc0bf87 table-cell">21.59 ms</td><td class="jsx-6d6a9301fcc0bf87 table-cell">30.48 ms</td></tr><tr class="jsx-dfe7859156a0174a table-row"><td class="jsx-6d6a9301fcc0bf87 table-cell">SCAN</td><td class="jsx-6d6a9301fcc0bf87 table-cell">1,396 ops/sec</td><td class="jsx-6d6a9301fcc0bf87 table-cell">0.72 ms</td><td class="jsx-6d6a9301fcc0bf87 table-cell">0.86 ms</td></tr></tbody></table></div>
<h2 id="" class="jsx-86f38cbe459c25ed heading-2">XI. Use Cases in Agentic AI</h2>
<h3 id="" class="jsx-9b0a55d81258b172 heading-3">1. Query Caching for Agent Memory</h3>
<div class="jsx-ae081af0992b9daf pre-wrapper"><div class="jsx-3068834386 code-block"><div class="jsx-3068834386 language-badge">python</div><pre style="color:#e4e4e7;background:#0d0d12;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none;padding:1.5em;margin:0;overflow:auto;border-radius:8px;border:1px solid rgba(0, 240, 255, 0.15);border-top:1px solid rgba(0, 240, 255, 0.15)"><code class="language-python" style="color:#e4e4e7;background:none;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none"><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">1</span><span class="token" style="color:#6b7280"># Store reasoning with semantic indexing</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">2</span><span>kv</span><span class="token" style="color:#a1a1aa">.</span><span>put_json</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#39ff14">&quot;reasoning:001&quot;</span><span class="token" style="color:#a1a1aa">,</span><span> </span><span class="token" style="color:#a1a1aa">{</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">3</span><span>    </span><span class="token" style="color:#39ff14">&quot;query&quot;</span><span class="token" style="color:#a1a1aa">:</span><span> </span><span class="token" style="color:#39ff14">&quot;How to handle authentication errors?&quot;</span><span class="token" style="color:#a1a1aa">,</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">4</span><span>    </span><span class="token" style="color:#39ff14">&quot;response&quot;</span><span class="token" style="color:#a1a1aa">:</span><span> </span><span class="token" style="color:#39ff14">&quot;Check token expiration, refresh if needed...&quot;</span><span class="token" style="color:#a1a1aa">,</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">5</span><span>    </span><span class="token" style="color:#39ff14">&quot;confidence&quot;</span><span class="token" style="color:#a1a1aa">:</span><span> </span><span class="token" style="color:#ff6b00">0.95</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">6</span><span></span><span class="token" style="color:#a1a1aa">}</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">7</span>
</span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">8</span><span></span><span class="token" style="color:#6b7280"># Later, find relevant past reasoning</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">9</span><span>results </span><span class="token" style="color:#00f0ff">=</span><span> kv</span><span class="token" style="color:#a1a1aa">.</span><span>search</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#39ff14">&quot;authentication token expired&quot;</span><span class="token" style="color:#a1a1aa">,</span><span> top_k</span><span class="token" style="color:#00f0ff">=</span><span class="token" style="color:#ff6b00">5</span><span class="token" style="color:#a1a1aa">)</span></span></code></pre></div></div>
<h3 id="" class="jsx-9b0a55d81258b172 heading-3">2. Tool Discovery by Capability</h3>
<div class="jsx-ae081af0992b9daf pre-wrapper"><div class="jsx-3068834386 code-block"><div class="jsx-3068834386 language-badge">python</div><pre style="color:#e4e4e7;background:#0d0d12;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none;padding:1.5em;margin:0;overflow:auto;border-radius:8px;border:1px solid rgba(0, 240, 255, 0.15);border-top:1px solid rgba(0, 240, 255, 0.15)"><code class="language-python" style="color:#e4e4e7;background:none;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none"><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">1</span><span class="token" style="color:#6b7280"># Store tool metadata</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">2</span><span>kv</span><span class="token" style="color:#a1a1aa">.</span><span>put_json</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#39ff14">&quot;tool:sql-executor&quot;</span><span class="token" style="color:#a1a1aa">,</span><span> </span><span class="token" style="color:#a1a1aa">{</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">3</span><span>    </span><span class="token" style="color:#39ff14">&quot;name&quot;</span><span class="token" style="color:#a1a1aa">:</span><span> </span><span class="token" style="color:#39ff14">&quot;SQL Executor&quot;</span><span class="token" style="color:#a1a1aa">,</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">4</span><span>    </span><span class="token" style="color:#39ff14">&quot;description&quot;</span><span class="token" style="color:#a1a1aa">:</span><span> </span><span class="token" style="color:#39ff14">&quot;Executes parameterized SQL queries&quot;</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">5</span><span></span><span class="token" style="color:#a1a1aa">}</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">6</span>
</span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">7</span><span></span><span class="token" style="color:#6b7280"># Agent searches for relevant tools</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">8</span><span>tools </span><span class="token" style="color:#00f0ff">=</span><span> kv</span><span class="token" style="color:#a1a1aa">.</span><span>search</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#39ff14">&quot;execute database queries&quot;</span><span class="token" style="color:#a1a1aa">,</span><span> top_k</span><span class="token" style="color:#00f0ff">=</span><span class="token" style="color:#ff6b00">3</span><span class="token" style="color:#a1a1aa">)</span></span></code></pre></div></div>
<h3 id="" class="jsx-9b0a55d81258b172 heading-3">3. Multi-Agent Knowledge Sharing</h3>
<div class="jsx-ae081af0992b9daf pre-wrapper"><div class="jsx-3068834386 code-block"><div class="jsx-3068834386 language-badge">python</div><pre style="color:#e4e4e7;background:#0d0d12;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none;padding:1.5em;margin:0;overflow:auto;border-radius:8px;border:1px solid rgba(0, 240, 255, 0.15);border-top:1px solid rgba(0, 240, 255, 0.15)"><code class="language-python" style="color:#e4e4e7;background:none;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none"><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">1</span><span class="token" style="color:#6b7280"># Agent A discovers rate limit</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">2</span><span>agent_a</span><span class="token" style="color:#a1a1aa">.</span><span>put_json</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#39ff14">&quot;discovery:rate-limit&quot;</span><span class="token" style="color:#a1a1aa">,</span><span> </span><span class="token" style="color:#a1a1aa">{</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">3</span><span>    </span><span class="token" style="color:#39ff14">&quot;endpoint&quot;</span><span class="token" style="color:#a1a1aa">:</span><span> </span><span class="token" style="color:#39ff14">&quot;/api/users&quot;</span><span class="token" style="color:#a1a1aa">,</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">4</span><span>    </span><span class="token" style="color:#39ff14">&quot;limit&quot;</span><span class="token" style="color:#a1a1aa">:</span><span> </span><span class="token" style="color:#39ff14">&quot;100 req/min&quot;</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">5</span><span></span><span class="token" style="color:#a1a1aa">}</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">6</span>
</span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">7</span><span></span><span class="token" style="color:#6b7280"># Agent B searches without knowing exact key</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">8</span><span>results </span><span class="token" style="color:#00f0ff">=</span><span> agent_b</span><span class="token" style="color:#a1a1aa">.</span><span>search</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#39ff14">&quot;API rate limiting&quot;</span><span class="token" style="color:#a1a1aa">,</span><span> top_k</span><span class="token" style="color:#00f0ff">=</span><span class="token" style="color:#ff6b00">1</span><span class="token" style="color:#a1a1aa">)</span></span></code></pre></div></div>
<h3 id="" class="jsx-9b0a55d81258b172 heading-3">4. Conversation Context Retrieval</h3>
<div class="jsx-ae081af0992b9daf pre-wrapper"><div class="jsx-3068834386 code-block"><div class="jsx-3068834386 language-badge">python</div><pre style="color:#e4e4e7;background:#0d0d12;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none;padding:1.5em;margin:0;overflow:auto;border-radius:8px;border:1px solid rgba(0, 240, 255, 0.15);border-top:1px solid rgba(0, 240, 255, 0.15)"><code class="language-python" style="color:#e4e4e7;background:none;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none"><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">1</span><span class="token" style="color:#6b7280"># Store conversation turns</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">2</span><span>kv</span><span class="token" style="color:#a1a1aa">.</span><span>put_json</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#39ff14">&quot;conv:turn:42&quot;</span><span class="token" style="color:#a1a1aa">,</span><span> </span><span class="token" style="color:#a1a1aa">{</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">3</span><span>    </span><span class="token" style="color:#39ff14">&quot;user&quot;</span><span class="token" style="color:#a1a1aa">:</span><span> </span><span class="token" style="color:#39ff14">&quot;What files are in the project?&quot;</span><span class="token" style="color:#a1a1aa">,</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">4</span><span>    </span><span class="token" style="color:#39ff14">&quot;assistant&quot;</span><span class="token" style="color:#a1a1aa">:</span><span> </span><span class="token" style="color:#39ff14">&quot;[directory listing]&quot;</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">5</span><span></span><span class="token" style="color:#a1a1aa">}</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">6</span>
</span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">7</span><span></span><span class="token" style="color:#6b7280"># Retrieve relevant context</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">8</span><span>context </span><span class="token" style="color:#00f0ff">=</span><span> kv</span><span class="token" style="color:#a1a1aa">.</span><span>search</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#39ff14">&quot;explore project structure&quot;</span><span class="token" style="color:#a1a1aa">,</span><span> top_k</span><span class="token" style="color:#00f0ff">=</span><span class="token" style="color:#ff6b00">5</span><span class="token" style="color:#a1a1aa">)</span></span></code></pre></div></div>
<h2 id="" class="jsx-86f38cbe459c25ed heading-2">XII. Getting Started</h2>
<h3 id="" class="jsx-9b0a55d81258b172 heading-3">Installation</h3>
<div class="jsx-ae081af0992b9daf pre-wrapper"><div class="jsx-3068834386 code-block"><div class="jsx-3068834386 language-badge">bash</div><pre style="color:#e4e4e7;background:#0d0d12;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none;padding:1.5em;margin:0;overflow:auto;border-radius:8px;border:1px solid rgba(0, 240, 255, 0.15);border-top:1px solid rgba(0, 240, 255, 0.15)"><code class="language-bash" style="color:#e4e4e7;background:none;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none"><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">1</span><span>pip </span><span class="token" style="color:#bf00ff">install</span><span> semantic-kv</span></span></code></pre></div></div>
<h3 id="" class="jsx-9b0a55d81258b172 heading-3">Start a Cluster</h3>
<div class="jsx-ae081af0992b9daf pre-wrapper"><div class="jsx-3068834386 code-block"><div class="jsx-3068834386 language-badge">python</div><pre style="color:#e4e4e7;background:#0d0d12;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none;padding:1.5em;margin:0;overflow:auto;border-radius:8px;border:1px solid rgba(0, 240, 255, 0.15);border-top:1px solid rgba(0, 240, 255, 0.15)"><code class="language-python" style="color:#e4e4e7;background:none;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none"><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">1</span><span class="token" style="color:#ff00aa">from</span><span> semantic_kv </span><span class="token" style="color:#ff00aa">import</span><span> SemanticKVNode</span><span class="token" style="color:#a1a1aa">,</span><span> DistributedSemanticKV
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">2</span>
</span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">3</span><span></span><span class="token" style="color:#6b7280"># Start nodes (in separate processes)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">4</span><span>node1 </span><span class="token" style="color:#00f0ff">=</span><span> SemanticKVNode</span><span class="token" style="color:#a1a1aa">(</span><span>location</span><span class="token" style="color:#00f0ff">=</span><span class="token" style="color:#39ff14">&quot;grpc://0.0.0.0:8815&quot;</span><span class="token" style="color:#a1a1aa">,</span><span> node_id</span><span class="token" style="color:#00f0ff">=</span><span class="token" style="color:#39ff14">&quot;node-1&quot;</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">5</span><span>node2 </span><span class="token" style="color:#00f0ff">=</span><span> SemanticKVNode</span><span class="token" style="color:#a1a1aa">(</span><span>location</span><span class="token" style="color:#00f0ff">=</span><span class="token" style="color:#39ff14">&quot;grpc://0.0.0.0:8816&quot;</span><span class="token" style="color:#a1a1aa">,</span><span> node_id</span><span class="token" style="color:#00f0ff">=</span><span class="token" style="color:#39ff14">&quot;node-2&quot;</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">6</span>
</span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">7</span><span></span><span class="token" style="color:#6b7280"># Connect client</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">8</span><span>client </span><span class="token" style="color:#00f0ff">=</span><span> DistributedSemanticKV</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#a1a1aa">[</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">9</span><span>    </span><span class="token" style="color:#39ff14">&quot;grpc://localhost:8815&quot;</span><span class="token" style="color:#a1a1aa">,</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">10</span><span>    </span><span class="token" style="color:#39ff14">&quot;grpc://localhost:8816&quot;</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">11</span><span></span><span class="token" style="color:#a1a1aa">]</span><span class="token" style="color:#a1a1aa">)</span></span></code></pre></div></div>
<h3 id="" class="jsx-9b0a55d81258b172 heading-3">Basic Operations</h3>
<div class="jsx-ae081af0992b9daf pre-wrapper"><div class="jsx-3068834386 code-block"><div class="jsx-3068834386 language-badge">python</div><pre style="color:#e4e4e7;background:#0d0d12;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none;padding:1.5em;margin:0;overflow:auto;border-radius:8px;border:1px solid rgba(0, 240, 255, 0.15);border-top:1px solid rgba(0, 240, 255, 0.15)"><code class="language-python" style="color:#e4e4e7;background:none;font-family:&#x27;Share Tech Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;font-size:0.9rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;tab-size:2;hyphens:none"><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">1</span><span class="token" style="color:#6b7280"># Store data</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">2</span><span>client</span><span class="token" style="color:#a1a1aa">.</span><span>put</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#39ff14">&quot;key1&quot;</span><span class="token" style="color:#a1a1aa">,</span><span> </span><span class="token" style="color:#39ff14">b&quot;value1&quot;</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">3</span><span>client</span><span class="token" style="color:#a1a1aa">.</span><span>put_json</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#39ff14">&quot;user:123&quot;</span><span class="token" style="color:#a1a1aa">,</span><span> </span><span class="token" style="color:#a1a1aa">{</span><span class="token" style="color:#39ff14">&quot;name&quot;</span><span class="token" style="color:#a1a1aa">:</span><span> </span><span class="token" style="color:#39ff14">&quot;Alice&quot;</span><span class="token" style="color:#a1a1aa">,</span><span> </span><span class="token" style="color:#39ff14">&quot;role&quot;</span><span class="token" style="color:#a1a1aa">:</span><span> </span><span class="token" style="color:#39ff14">&quot;admin&quot;</span><span class="token" style="color:#a1a1aa">}</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">4</span>
</span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">5</span><span></span><span class="token" style="color:#6b7280"># Exact retrieval</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">6</span><span>value </span><span class="token" style="color:#00f0ff">=</span><span> client</span><span class="token" style="color:#a1a1aa">.</span><span>get</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#39ff14">&quot;key1&quot;</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">7</span><span>user </span><span class="token" style="color:#00f0ff">=</span><span> client</span><span class="token" style="color:#a1a1aa">.</span><span>get_json</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#39ff14">&quot;user:123&quot;</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">8</span>
</span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">9</span><span></span><span class="token" style="color:#6b7280"># Semantic search</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">10</span><span>results </span><span class="token" style="color:#00f0ff">=</span><span> client</span><span class="token" style="color:#a1a1aa">.</span><span>search</span><span class="token" style="color:#a1a1aa">(</span><span class="token" style="color:#39ff14">&quot;find admin users&quot;</span><span class="token" style="color:#a1a1aa">,</span><span> top_k</span><span class="token" style="color:#00f0ff">=</span><span class="token" style="color:#ff6b00">5</span><span class="token" style="color:#a1a1aa">,</span><span> threshold</span><span class="token" style="color:#00f0ff">=</span><span class="token" style="color:#ff6b00">0.7</span><span class="token" style="color:#a1a1aa">)</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">11</span><span></span><span class="token" style="color:#ff00aa">for</span><span> key</span><span class="token" style="color:#a1a1aa">,</span><span> value</span><span class="token" style="color:#a1a1aa">,</span><span> similarity</span><span class="token" style="color:#a1a1aa">,</span><span> node </span><span class="token" style="color:#ff00aa">in</span><span> results</span><span class="token" style="color:#a1a1aa">:</span><span>
</span></span><span><span class="react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.5em;padding-right:1em;text-align:right;user-select:none;color:#4a4a5a;border-right:1px solid rgba(255,255,255,0.05);margin-right:1em">12</span><span>    </span><span class="token" style="color:#ff00aa">print</span><span class="token" style="color:#a1a1aa">(</span><span class="token string-interpolation" style="color:#39ff14">f&quot;Key: </span><span class="token string-interpolation interpolation" style="color:#a1a1aa">{</span><span class="token string-interpolation interpolation">key</span><span class="token string-interpolation interpolation" style="color:#a1a1aa">}</span><span class="token string-interpolation" style="color:#39ff14">, Score: </span><span class="token string-interpolation interpolation" style="color:#a1a1aa">{</span><span class="token string-interpolation interpolation">similarity</span><span class="token string-interpolation interpolation" style="color:#a1a1aa">:</span><span class="token string-interpolation interpolation format-spec">.2f</span><span class="token string-interpolation interpolation" style="color:#a1a1aa">}</span><span class="token string-interpolation" style="color:#39ff14">&quot;</span><span class="token" style="color:#a1a1aa">)</span></span></code></pre></div></div>
<h2 id="" class="jsx-86f38cbe459c25ed heading-2">XIII. Conclusion</h2>
<p class="jsx-fa6f63a6524ee32c paragraph">Semantic Cache bridges the gap between traditional caching systems and modern AI requirements. The key architectural decisions:</p>
<ul class="jsx-95fcca5befc65769 unordered-list">
<li class="jsx-4a0fac569cd62d29 list-item"><strong class="jsx-f6f1f2b90dda302a strong">Apache Arrow Flight</strong> for high-performance RPC with zero-copy semantics</li>
<li class="jsx-4a0fac569cd62d29 list-item"><strong class="jsx-f6f1f2b90dda302a strong">Arrow IPC format</strong> for efficient persistence and cross-language compatibility</li>
<li class="jsx-4a0fac569cd62d29 list-item"><strong class="jsx-f6f1f2b90dda302a strong">In-memory primary storage</strong> with optional disk persistence</li>
<li class="jsx-4a0fac569cd62d29 list-item"><strong class="jsx-f6f1f2b90dda302a strong">Consistent hashing</strong> for deterministic key routing with minimal reshuffling</li>
<li class="jsx-4a0fac569cd62d29 list-item"><strong class="jsx-f6f1f2b90dda302a strong">Scatter-gather pattern</strong> for distributed semantic search</li>
<li class="jsx-4a0fac569cd62d29 list-item"><strong class="jsx-f6f1f2b90dda302a strong">HNSW indexing</strong> for sub-millisecond vector similarity search</li>
</ul>
<p class="jsx-fa6f63a6524ee32c paragraph">This combination enables agentic AI systems to:</p>
<ul class="jsx-95fcca5befc65769 unordered-list">
<li class="jsx-4a0fac569cd62d29 list-item">Find relevant past experiences by meaning</li>
<li class="jsx-4a0fac569cd62d29 list-item">Avoid redundant computations</li>
<li class="jsx-4a0fac569cd62d29 list-item">Share knowledge across agents naturally</li>
<li class="jsx-4a0fac569cd62d29 list-item">Scale horizontally with demand</li>
</ul>
<div class="jsx-150839ba60f82142 divider-wrapper"><hr class="jsx-150839ba60f82142 divider"/></div>
<p class="jsx-fa6f63a6524ee32c paragraph"><strong class="jsx-f6f1f2b90dda302a strong">Related Reading</strong>:</p>
<ul class="jsx-95fcca5befc65769 unordered-list">
<li class="jsx-4a0fac569cd62d29 list-item"><a href="https://arrow.apache.org/docs/format/Flight.html" target="_blank" rel="noopener noreferrer" class="jsx-49ebcff357f44447 link">Apache Arrow Flight</a></li>
<li class="jsx-4a0fac569cd62d29 list-item"><a href="https://arxiv.org/abs/1603.09320" target="_blank" rel="noopener noreferrer" class="jsx-49ebcff357f44447 link">Hierarchical Navigable Small World (HNSW)</a></li>
<li class="jsx-4a0fac569cd62d29 list-item"><a href="https://en.wikipedia.org/wiki/Consistent_hashing" target="_blank" rel="noopener noreferrer" class="jsx-49ebcff357f44447 link">Consistent Hashing</a></li>
</ul></article></main><footer class="jsx-3677045656 footer"><div class="jsx-3677045656 footer-content"><div class="jsx-3677045656 social-links"><a href="https://github.com/ddak" rel="noreferrer" target="_blank" aria-label="GitHub" class="jsx-3677045656 social-link"><div class="jsx-805584109 icon-wrapper"><svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" style="color:#a1a1aa;font-size:24px;transition:all 0.3s ease" class="jsx-805584109" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></div></a><a href="https://www.linkedin.com/in/dawood-khan-phd/" rel="noreferrer" target="_blank" aria-label="LinkedIn" class="jsx-3677045656 social-link"><div class="jsx-3835249677 icon-wrapper"><svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" style="color:#a1a1aa;font-size:24px;transition:all 0.3s ease" class="jsx-3835249677" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"></path></svg></div></a></div><p class="jsx-3677045656 copyright"><span class="jsx-3677045656 terminal-prompt">$</span> Dawood Khan ¬© <!-- -->2026</p></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postMetadata":{"title":"Semantic Cache: Supercharging Agentic AI with Distributed Semantic Search","description":"A deep dive into building a distributed semantic cache using Apache Arrow Flight, HNSW indexing, and consistent hashing - enabling AI agents to retrieve information by meaning, not just exact keys.","imgName":"semantic-cache/semantic-cache.jpeg","date":"Jan 14, 2025","tags":["AI","Semantic Search","Distributed Systems","Agentic AI","Apache Arrow","Vector Database"],"keywords":["semantic cache","agentic AI","distributed systems","vector search","HNSW","Apache Arrow","Arrow Flight","consistent hashing"],"id":"semantic-cache"},"postContent":{"compiledSource":"\"use strict\";\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = {\n    a: \"a\",\n    code: \"code\",\n    em: \"em\",\n    h2: \"h2\",\n    h3: \"h3\",\n    h4: \"h4\",\n    h6: \"h6\",\n    hr: \"hr\",\n    img: \"img\",\n    li: \"li\",\n    p: \"p\",\n    pre: \"pre\",\n    strong: \"strong\",\n    table: \"table\",\n    tbody: \"tbody\",\n    td: \"td\",\n    th: \"th\",\n    thead: \"thead\",\n    tr: \"tr\",\n    ul: \"ul\",\n    ..._provideComponents(),\n    ...props.components\n  };\n  return _jsxs(_Fragment, {\n    children: [_jsx(_components.p, {\n      children: _jsx(_components.img, {\n        src: \"semantic-cache/semantic-cache.jpeg\",\n        alt: \"\\\"Semantic Cache Architecture\\\"\"\n      })\n    }), \"\\n\", _jsxs(_components.h6, {\n      id: \"published-on-jan-14-2025\",\n      children: [\"Published on: \", _jsx(_components.strong, {\n        children: \"Jan 14, 2025\"\n      })]\n    }), \"\\n\", _jsx(_components.h2, {\n      id: \"semantic-cache-supercharging-agentic-ai-with-distributed-semantic-search\",\n      children: \"Semantic Cache: Supercharging Agentic AI with Distributed Semantic Search\"\n    }), \"\\n\", _jsx(_components.h2, {\n      id: \"i-introduction\",\n      children: \"I. Introduction\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Traditional caching systems require exact key matches to retrieve data. But what if you could find cached information by \", _jsx(_components.em, {\n        children: \"meaning\"\n      }), \" instead? This is the core idea behind \", _jsx(_components.strong, {\n        children: \"Semantic Cache\"\n      }), \" - a distributed key-value store I built that combines the speed of traditional caching with the intelligence of semantic search.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"In the world of agentic AI, where autonomous agents need to reason, remember, and act without constant human guidance, semantic caching becomes a game-changer. Instead of agents repeating expensive computations or API calls for semantically similar queries, they can retrieve relevant past results instantly.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      id: \"ii-the-problem-with-traditional-caching\",\n      children: \"II. The Problem with Traditional Caching\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Traditional caching systems like Redis or Memcached are incredibly fast, but they have a fundamental limitation: \", _jsx(_components.strong, {\n        children: \"they only work with exact key matches\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Consider this scenario in an agentic AI system:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"# Agent caches a response\\ncache.set(\\\"How to optimize database queries?\\\", response_1)\\n\\n# Later, a semantically similar question comes in\\ncache.get(\\\"database query optimization techniques\\\")  # Returns None!\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"The second query is semantically identical to the first, but traditional caches miss this connection entirely. The agent must recompute or re-fetch the answer, wasting time and resources.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(_components.strong, {\n        children: \"Semantic Cache solves this\"\n      }), \" by indexing data with vector embeddings and enabling similarity-based retrieval:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"# Store with semantic indexing\\nsemantic_kv.put(\\\"optimize-db-001\\\", {\\n    \\\"query\\\": \\\"How to optimize database queries?\\\",\\n    \\\"response\\\": \\\"Use indexing, query optimization, caching...\\\"\\n})\\n\\n# Search by meaning - finds the relevant cached response!\\nresults = semantic_kv.search(\\\"database query optimization techniques\\\", top_k=3)\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      id: \"iii-technology-stack\",\n      children: \"III. Technology Stack\"\n    }), \"\\n\", _jsx(_components.h3, {\n      id: \"apache-arrow-the-foundation\",\n      children: \"Apache Arrow: The Foundation\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(_components.strong, {\n        children: \"Apache Arrow\"\n      }), \" is a cross-language development platform for in-memory columnar data. The semantic cache uses Arrow in two critical ways:\"]\n    }), \"\\n\", _jsx(_components.h4, {\n      id: \"1-arrow-ipc-for-persistence\",\n      children: \"1. Arrow IPC for Persistence\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"The persistence layer uses Arrow's IPC (Inter-Process Communication) format to serialize KV entries to disk. The schema is defined as:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"KV_SCHEMA = pa.schema([\\n    ('key', pa.string()),\\n    ('value', pa.large_binary()),\\n    ('embedding', pa.list_(pa.float32())),\\n    ('created_at', pa.int64()),\\n    ('ttl_ms', pa.int64()),\\n    ('access_count', pa.int64()),\\n    ('last_accessed', pa.int64()),\\n])\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"This columnar format provides:\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"Efficient compression\"\n        }), \": Similar data types stored together compress better\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"Fast partial reads\"\n        }), \": Can read only specific columns without loading entire records\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"Zero-copy deserialization\"\n        }), \": Data can be memory-mapped directly without parsing\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"Cross-language compatibility\"\n        }), \": Arrow files can be read by Python, C++, Java, Rust, etc.\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h4, {\n      id: \"2-arrow-flight-for-network-communication\",\n      children: \"2. Arrow Flight for Network Communication\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(_components.strong, {\n        children: \"Arrow Flight\"\n      }), \" is a high-performance RPC framework built on gRPC and Arrow. Each node in the cluster is a Flight server that handles operations via the \", _jsx(_components.code, {\n        children: \"do_action\"\n      }), \" protocol:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"class SemanticKVNode(flight.FlightServerBase):\\n    def do_action(self, context, action):\\n        action_type = action.type\\n        body = action.body.to_pybytes()\\n\\n        if action_type == \\\"put\\\":\\n            return self._action_put(body)\\n        elif action_type == \\\"get\\\":\\n            return self._action_get(body)\\n        elif action_type == \\\"search_local\\\":\\n            return self._action_search_local(body)\\n        # ... other actions\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Available Flight actions:\"\n    }), \"\\n\", _jsxs(_components.table, {\n      children: [_jsx(_components.thead, {\n        children: _jsxs(_components.tr, {\n          children: [_jsx(_components.th, {\n            children: \"Action\"\n          }), _jsx(_components.th, {\n            children: \"Description\"\n          })]\n        })\n      }), _jsxs(_components.tbody, {\n        children: [_jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.code, {\n              children: \"put\"\n            })\n          }), _jsx(_components.td, {\n            children: \"Store key-value pair with embedding\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.code, {\n              children: \"put_replica\"\n            })\n          }), _jsx(_components.td, {\n            children: \"Store replica (internal, from other nodes)\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.code, {\n              children: \"get\"\n            })\n          }), _jsx(_components.td, {\n            children: \"Exact key lookup with TTL check\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.code, {\n              children: \"search_local\"\n            })\n          }), _jsx(_components.td, {\n            children: \"Semantic search on local HNSW index\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.code, {\n              children: \"delete\"\n            })\n          }), _jsx(_components.td, {\n            children: \"Remove key from store and index\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.code, {\n              children: \"scan\"\n            })\n          }), _jsx(_components.td, {\n            children: \"List keys by prefix\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.code, {\n              children: \"stats\"\n            })\n          }), _jsx(_components.td, {\n            children: \"Return node statistics\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.code, {\n              children: \"health\"\n            })\n          }), _jsx(_components.td, {\n            children: \"Health check\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.code, {\n              children: \"clear\"\n            })\n          }), _jsx(_components.td, {\n            children: \"Clear all data\"\n          })]\n        })]\n      })]\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.strong, {\n        children: \"Why Arrow Flight over plain gRPC?\"\n      })\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"Native columnar data\"\n        }), \": Perfect for batch operations and large result sets\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"Zero-copy semantics\"\n        }), \": Data moves directly from network buffer to application\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"Built-in streaming\"\n        }), \": Efficient for large result sets without loading all into memory\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"Standard protocol\"\n        }), \": Interoperable with Arrow ecosystem (Spark, Pandas, DuckDB)\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      id: \"iv-in-memory-storage-architecture\",\n      children: \"IV. In-Memory Storage Architecture\"\n    }), \"\\n\", _jsx(_components.h3, {\n      id: \"primary-storage-python-dictionary\",\n      children: \"Primary Storage: Python Dictionary\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"The cache operates as an \", _jsx(_components.strong, {\n        children: \"in-memory first\"\n      }), \" system. Each node maintains data in a Python dictionary with \", _jsx(_components.code, {\n        children: \"KVEntry\"\n      }), \" dataclass objects:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"@dataclass\\nclass KVEntry:\\n    key: str\\n    value: bytes\\n    embedding: np.ndarray      # Vector embedding (384-3072 dims)\\n    created_at: int            # Timestamp (milliseconds)\\n    ttl_ms: int                # Time-to-live (0 = no expiration)\\n    access_count: int = 0      # Access statistics\\n    last_accessed: int = 0     # Last access timestamp\\n\\n# Storage structure\\nself._store: Dict[str, KVEntry] = {}\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h3, {\n      id: \"thread-safety\",\n      children: \"Thread Safety\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"All operations are protected by a reentrant lock (\", _jsx(_components.code, {\n        children: \"threading.RLock\"\n      }), \"):\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"def _action_get(self, body: bytes):\\n    key = body.decode()\\n\\n    with self._lock:  # Thread-safe access\\n        if key not in self._store:\\n            return [flight.Result(b\\\"\\\")]\\n\\n        entry = self._store[key]\\n\\n        # Check expiration\\n        if self._is_expired(entry):\\n            self._delete_entry(key)\\n            return [flight.Result(b\\\"\\\")]\\n\\n        # Update access stats\\n        entry.access_count += 1\\n        entry.last_accessed = int(time.time() * 1000)\\n\\n        return [flight.Result(entry.value)]\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h3, {\n      id: \"ttl-expiration\",\n      children: \"TTL Expiration\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Entries support time-to-live with lazy expiration checking:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"def _is_expired(self, entry: KVEntry) -\u003e bool:\\n    if entry.ttl_ms \u003c= 0:\\n        return False  # No expiration\\n    now_ms = int(time.time() * 1000)\\n    return (now_ms - entry.created_at) \u003e entry.ttl_ms\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      id: \"v-persistence-layer\",\n      children: \"V. Persistence Layer\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"While the primary storage is in-memory, the system provides durable persistence through the \", _jsx(_components.code, {\n        children: \"ArrowKVStore\"\n      }), \" class:\"]\n    }), \"\\n\", _jsx(_components.h3, {\n      id: \"saving-data\",\n      children: \"Saving Data\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"class ArrowKVStore:\\n    def save(self, entries: Dict[str, KVEntry], index=None, metadata=None):\\n        # Convert entries to Arrow table\\n        keys, values, embeddings = [], [], []\\n        for key, entry in entries.items():\\n            keys.append(key)\\n            values.append(entry.value)\\n            embeddings.append(entry.embedding.tolist())\\n\\n        table = pa.Table.from_arrays([\\n            pa.array(keys),\\n            pa.array(values, type=pa.large_binary()),\\n            pa.array(embeddings, type=pa.list_(pa.float32())),\\n            # ... other columns\\n        ], schema=KV_SCHEMA)\\n\\n        # Write to Arrow IPC file\\n        with pa.OSFile(str(self._data_file), 'wb') as sink:\\n            writer = ipc.new_file(sink, table.schema)\\n            writer.write_table(table)\\n            writer.close()\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h3, {\n      id: \"loading-data\",\n      children: \"Loading Data\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"def load(self) -\u003e Tuple[List[PersistedEntry], Dict]:\\n    # Memory-map the Arrow file for zero-copy reads\\n    with pa.memory_map(str(self._data_file), 'r') as source:\\n        reader = ipc.open_file(source)\\n        table = reader.read_all()\\n\\n    entries = []\\n    for i in range(table.num_rows):\\n        entry = PersistedEntry(\\n            key=table['key'][i].as_py(),\\n            value=table['value'][i].as_py(),\\n            embedding=np.array(table['embedding'][i].as_py()),\\n            # ... other fields\\n        )\\n        entries.append(entry)\\n\\n    return entries, metadata\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h3, {\n      id: \"hnsw-index-persistence\",\n      children: \"HNSW Index Persistence\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"The HNSW index is persisted separately using hnswlib's native format:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"# Saving\\nindex.save_index(str(self._index_file))\\n\\n# Loading\\nindex = hnswlib.Index(space='cosine', dim=dim)\\nindex.load_index(str(self._index_file))\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h3, {\n      id: \"snapshot-manager\",\n      children: \"Snapshot Manager\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"For backup and recovery, the \", _jsx(_components.code, {\n        children: \"SnapshotManager\"\n      }), \" provides:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"class SnapshotManager:\\n    def create_snapshot(self, name: str = None):\\n        # Copy all data files to snapshot directory\\n        shutil.copytree(\\n            self._data_dir,\\n            snapshot_dir,\\n            ignore=shutil.ignore_patterns('snapshots')\\n        )\\n\\n    def restore_snapshot(self, name: str):\\n        # Remove current data, copy snapshot back\\n        ...\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      id: \"vi-cluster-formation-and-topology\",\n      children: \"VI. Cluster Formation and Topology\"\n    }), \"\\n\", _jsx(_components.h3, {\n      id: \"static-node-configuration\",\n      children: \"Static Node Configuration\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"The cluster uses a \", _jsx(_components.strong, {\n        children: \"static configuration\"\n      }), \" model where nodes are known at startup:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"# Client connects to pre-configured nodes\\nclient = DistributedSemanticKV([\\n    \\\"grpc://node1:8815\\\",\\n    \\\"grpc://node2:8816\\\",\\n    \\\"grpc://node3:8817\\\",\\n    \\\"grpc://node4:8818\\\",\\n])\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Each node is an independent Flight server:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"# Start individual nodes\\nnode1 = SemanticKVNode(\\n    location=\\\"grpc://0.0.0.0:8815\\\",\\n    node_id=\\\"node-1\\\",\\n    embedding_provider=SentenceTransformerEmbedding(),\\n)\\nnode1.serve()  # Blocks, runs gRPC server\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h3, {\n      id: \"connection-pooling\",\n      children: \"Connection Pooling\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"The client maintains a \", _jsx(_components.strong, {\n        children: \"lazy connection pool\"\n      }), \" with thread-safe initialization:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"def _get_client(self, node: str) -\u003e flight.FlightClient:\\n    with self._clients_lock:\\n        if node not in self._clients:\\n            self._clients[node] = flight.FlightClient(node)\\n        return self._clients[node]\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h3, {\n      id: \"retry-logic-with-backoff\",\n      children: \"Retry Logic with Backoff\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Failed operations are retried with exponential backoff:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"def _execute_with_retry(self, node, action_type, body, retries=2):\\n    for attempt in range(retries + 1):\\n        try:\\n            client = self._get_client(node)\\n            action = flight.Action(action_type, body)\\n            results = list(client.do_action(action))\\n            return results[0].body.to_pybytes()\\n        except Exception:\\n            # Remove stale connection, backoff, retry\\n            del self._clients[node]\\n            time.sleep(0.1 * (attempt + 1))\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      id: \"vii-query-distribution-consistent-hashing\",\n      children: \"VII. Query Distribution: Consistent Hashing\"\n    }), \"\\n\", _jsx(_components.h3, {\n      id: \"how-consistent-hashing-works\",\n      children: \"How Consistent Hashing Works\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"The system uses \", _jsx(_components.strong, {\n        children: \"consistent hashing with virtual nodes\"\n      }), \" to distribute keys across the cluster. The implementation uses MD5 hashing:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"class ConsistentHashRing:\\n    def __init__(self, nodes: List[str], virtual_nodes: int = 150):\\n        self._virtual_nodes = virtual_nodes\\n        self._ring: List[Tuple[int, str]] = []\\n\\n        for node in nodes:\\n            self.add_node(node)\\n\\n    def _hash(self, key: str) -\u003e int:\\n        return int(hashlib.md5(key.encode()).hexdigest(), 16)\\n\\n    def add_node(self, node: str):\\n        # Add virtual nodes for even distribution\\n        for i in range(self._virtual_nodes):\\n            virtual_key = f\\\"{node}:vnode:{i}\\\"\\n            hash_val = self._hash(virtual_key)\\n            self._ring.append((hash_val, node))\\n\\n        # Sort for binary search\\n        self._ring.sort(key=lambda x: x[0])\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h3, {\n      id: \"virtual-nodes-for-even-distribution\",\n      children: \"Virtual Nodes for Even Distribution\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"With 150 virtual nodes per physical node:\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"Even key distribution\"\n        }), \": Keys spread uniformly across nodes\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"Minimal reshuffling\"\n        }), \": Adding/removing a node only remaps ~1/N keys\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"O(log n) lookups\"\n        }), \": Binary search on sorted ring\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"def get_node(self, key: str) -\u003e str:\\n    hash_val = self._hash(key)\\n\\n    # Binary search for first node with hash \u003e= key hash\\n    idx = bisect_right(self._hash_values, hash_val)\\n\\n    # Wrap around if past the end\\n    if idx \u003e= len(self._ring):\\n        idx = 0\\n\\n    return self._ring[idx][1]\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h3, {\n      id: \"operation-routing-patterns\",\n      children: \"Operation Routing Patterns\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Different operations use different routing strategies:\"\n    }), \"\\n\", _jsxs(_components.table, {\n      children: [_jsx(_components.thead, {\n        children: _jsxs(_components.tr, {\n          children: [_jsx(_components.th, {\n            children: \"Operation\"\n          }), _jsx(_components.th, {\n            children: \"Strategy\"\n          }), _jsx(_components.th, {\n            children: \"Description\"\n          })]\n        })\n      }), _jsxs(_components.tbody, {\n        children: [_jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.code, {\n              children: \"put(key, value)\"\n            })\n          }), _jsx(_components.td, {\n            children: _jsx(_components.strong, {\n              children: \"Deterministic\"\n            })\n          }), _jsx(_components.td, {\n            children: \"Hash key -\u003e single responsible node\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.code, {\n              children: \"get(key)\"\n            })\n          }), _jsx(_components.td, {\n            children: _jsx(_components.strong, {\n              children: \"Deterministic\"\n            })\n          }), _jsx(_components.td, {\n            children: \"Hash key -\u003e single responsible node\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.code, {\n              children: \"delete(key)\"\n            })\n          }), _jsx(_components.td, {\n            children: _jsx(_components.strong, {\n              children: \"Deterministic\"\n            })\n          }), _jsx(_components.td, {\n            children: \"Hash key -\u003e single responsible node\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.code, {\n              children: \"search(query)\"\n            })\n          }), _jsx(_components.td, {\n            children: _jsx(_components.strong, {\n              children: \"Scatter-Gather\"\n            })\n          }), _jsx(_components.td, {\n            children: \"Query ALL nodes -\u003e merge by similarity\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.code, {\n              children: \"scan(prefix)\"\n            })\n          }), _jsx(_components.td, {\n            children: _jsx(_components.strong, {\n              children: \"Scatter-Gather\"\n            })\n          }), _jsx(_components.td, {\n            children: \"Query ALL nodes -\u003e deduplicate keys\"\n          })]\n        })]\n      })]\n    }), \"\\n\", _jsx(_components.h3, {\n      id: \"put-deterministic-write\",\n      children: \"PUT: Deterministic Write\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"def put(self, key: str, value: bytes, ttl_ms: int = 0) -\u003e bool:\\n    # Hash determines the single responsible node\\n    node = self._ring.get_node(key)\\n\\n    data = json.dumps({\\n        'key': key,\\n        'value': list(value),\\n        'ttl_ms': ttl_ms\\n    })\\n\\n    result = self._execute_with_retry(node, \\\"put\\\", data.encode())\\n    return result == b\\\"ok\\\"\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h3, {\n      id: \"get-deterministic-read\",\n      children: \"GET: Deterministic Read\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"def get(self, key: str) -\u003e Optional[bytes]:\\n    # Same hash -\u003e same node as PUT\\n    node = self._ring.get_node(key)\\n\\n    result = self._execute_with_retry(node, \\\"get\\\", key.encode())\\n    return result if result else None\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h3, {\n      id: \"search-scatter-gather\",\n      children: \"SEARCH: Scatter-Gather\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Semantic search \", _jsx(_components.strong, {\n        children: \"must query all nodes\"\n      }), \" because similar items may be distributed anywhere:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"def search(self, query: str, top_k: int = 10, threshold: float = 0.7):\\n    params = json.dumps({\\n        'query': query,\\n        'top_k': top_k,\\n        'threshold': threshold\\n    })\\n\\n    def search_node(node: str) -\u003e List[dict]:\\n        result = self._execute_with_retry(node, \\\"search_local\\\", params.encode())\\n        return json.loads(result.decode()) if result else []\\n\\n    # SCATTER: Query all nodes in parallel\\n    all_nodes = self._ring.get_all_nodes()\\n    futures = {\\n        self._executor.submit(search_node, node): node\\n        for node in all_nodes\\n    }\\n\\n    # GATHER: Collect results with timeout\\n    all_results = []\\n    for future in as_completed(futures, timeout=self._search_timeout):\\n        node_results = future.result()\\n        all_results.extend(node_results)\\n\\n    # MERGE: Sort by similarity, return top-k\\n    all_results.sort(key=lambda x: x['similarity'], reverse=True)\\n    return all_results[:top_k]\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"The thread pool uses \", _jsx(_components.code, {\n        children: \"nodes * 2\"\n      }), \" workers by default for parallel operations:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"self._executor = ThreadPoolExecutor(max_workers=len(nodes) * 2)\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      id: \"viii-vector-indexing-with-hnsw\",\n      children: \"VIII. Vector Indexing with HNSW\"\n    }), \"\\n\", _jsx(_components.h3, {\n      id: \"hnsw-algorithm\",\n      children: \"HNSW Algorithm\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(_components.strong, {\n        children: \"HNSW (Hierarchical Navigable Small World)\"\n      }), \" is a state-of-the-art algorithm for approximate nearest neighbor search:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"self._index = create_vector_index(\\n    dim=self._embedding_provider.dimension,  # 384-3072\\n    max_elements=max_entries,                 # 100,000 default\\n    ef_construction=200,                      # Build quality\\n    M=16,                                     # Connections per node\\n    ef_search=50                              # Search quality\\n)\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h3, {\n      id: \"index-operations\",\n      children: \"Index Operations\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Each node maintains its own HNSW index with bidirectional mappings:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"# Mappings between keys and index positions\\nself._key_to_idx: Dict[str, int] = {}\\nself._idx_to_key: Dict[int, str] = {}\\nself._next_idx = 0\\n\\n# Adding to index during PUT\\nidx = self._next_idx\\nself._index.add_items(embedding.reshape(1, -1), [idx])\\nself._key_to_idx[key] = idx\\nself._idx_to_key[idx] = key\\nself._next_idx += 1\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h3, {\n      id: \"local-semantic-search\",\n      children: \"Local Semantic Search\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"def _action_search_local(self, body: bytes):\\n    params = json.loads(body.decode())\\n    query = params['query']\\n    top_k = params.get('top_k', 10)\\n    threshold = params.get('threshold', 0.7)\\n\\n    # Generate query embedding\\n    query_embedding = self._get_embedding(query)\\n\\n    # Search HNSW index\\n    k = min(top_k, self._index.get_current_count())\\n    labels, distances = self._index.knn_query(\\n        query_embedding.reshape(1, -1),\\n        k=k\\n    )\\n\\n    results = []\\n    for label, dist in zip(labels[0], distances[0]):\\n        # Cosine distance to similarity\\n        similarity = 1.0 - dist\\n\\n        if similarity \u003e= threshold:\\n            key = self._idx_to_key[label]\\n            entry = self._store[key]\\n\\n            results.append({\\n                'key': key,\\n                'value': entry.value.decode(),\\n                'similarity': float(similarity),\\n                'node': self.node_id\\n            })\\n\\n    return [flight.Result(json.dumps(results).encode())]\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      id: \"ix-embedding-providers\",\n      children: \"IX. Embedding Providers\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Three embedding backends are supported:\"\n    }), \"\\n\", _jsx(_components.h3, {\n      id: \"sentencetransformers-recommended\",\n      children: \"SentenceTransformers (Recommended)\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"from sentence_transformers import SentenceTransformer\\n\\nclass SentenceTransformerEmbedding:\\n    def __init__(self, model_name=\\\"all-MiniLM-L6-v2\\\"):\\n        self.model = SentenceTransformer(model_name)\\n        self.dimension = self.model.get_sentence_embedding_dimension()\\n\\n    def embed(self, text: str) -\u003e np.ndarray:\\n        return self.model.encode(text, convert_to_numpy=True)\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h3, {\n      id: \"openai-embeddings-premium\",\n      children: \"OpenAI Embeddings (Premium)\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"import openai\\n\\nclass OpenAIEmbedding:\\n    def __init__(self, model=\\\"text-embedding-3-small\\\"):\\n        self.client = openai.OpenAI()\\n        self.model = model\\n\\n    def embed(self, text: str) -\u003e np.ndarray:\\n        response = self.client.embeddings.create(\\n            input=text,\\n            model=self.model\\n        )\\n        return np.array(response.data[0].embedding)\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      id: \"x-performance-characteristics\",\n      children: \"X. Performance Characteristics\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Benchmarked on a 4-node localhost cluster:\"\n    }), \"\\n\", _jsxs(_components.table, {\n      children: [_jsx(_components.thead, {\n        children: _jsxs(_components.tr, {\n          children: [_jsx(_components.th, {\n            children: \"Operation\"\n          }), _jsx(_components.th, {\n            children: \"Throughput\"\n          }), _jsx(_components.th, {\n            children: \"Avg Latency\"\n          }), _jsx(_components.th, {\n            children: \"P99 Latency\"\n          })]\n        })\n      }), _jsxs(_components.tbody, {\n        children: [_jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: \"GET (hit)\"\n          }), _jsx(_components.td, {\n            children: \"7,195 ops/sec\"\n          }), _jsx(_components.td, {\n            children: \"0.14 ms\"\n          }), _jsx(_components.td, {\n            children: \"0.18 ms\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: \"GET (miss)\"\n          }), _jsx(_components.td, {\n            children: \"6,288 ops/sec\"\n          }), _jsx(_components.td, {\n            children: \"0.16 ms\"\n          }), _jsx(_components.td, {\n            children: \"0.62 ms\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: \"PUT (100B)\"\n          }), _jsx(_components.td, {\n            children: \"3,579 ops/sec\"\n          }), _jsx(_components.td, {\n            children: \"0.28 ms\"\n          }), _jsx(_components.td, {\n            children: \"0.43 ms\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: \"PUT (1KB)\"\n          }), _jsx(_components.td, {\n            children: \"2,721 ops/sec\"\n          }), _jsx(_components.td, {\n            children: \"0.37 ms\"\n          }), _jsx(_components.td, {\n            children: \"0.46 ms\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: \"DELETE\"\n          }), _jsx(_components.td, {\n            children: \"7,100 ops/sec\"\n          }), _jsx(_components.td, {\n            children: \"0.14 ms\"\n          }), _jsx(_components.td, {\n            children: \"0.20 ms\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: \"SEARCH (1K keys)\"\n          }), _jsx(_components.td, {\n            children: \"344 ops/sec\"\n          }), _jsx(_components.td, {\n            children: \"2.91 ms\"\n          }), _jsx(_components.td, {\n            children: \"3.37 ms\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: \"SEARCH (10K keys)\"\n          }), _jsx(_components.td, {\n            children: \"46 ops/sec\"\n          }), _jsx(_components.td, {\n            children: \"21.59 ms\"\n          }), _jsx(_components.td, {\n            children: \"30.48 ms\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: \"SCAN\"\n          }), _jsx(_components.td, {\n            children: \"1,396 ops/sec\"\n          }), _jsx(_components.td, {\n            children: \"0.72 ms\"\n          }), _jsx(_components.td, {\n            children: \"0.86 ms\"\n          })]\n        })]\n      })]\n    }), \"\\n\", _jsx(_components.h2, {\n      id: \"xi-use-cases-in-agentic-ai\",\n      children: \"XI. Use Cases in Agentic AI\"\n    }), \"\\n\", _jsx(_components.h3, {\n      id: \"1-query-caching-for-agent-memory\",\n      children: \"1. Query Caching for Agent Memory\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"# Store reasoning with semantic indexing\\nkv.put_json(\\\"reasoning:001\\\", {\\n    \\\"query\\\": \\\"How to handle authentication errors?\\\",\\n    \\\"response\\\": \\\"Check token expiration, refresh if needed...\\\",\\n    \\\"confidence\\\": 0.95\\n})\\n\\n# Later, find relevant past reasoning\\nresults = kv.search(\\\"authentication token expired\\\", top_k=5)\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h3, {\n      id: \"2-tool-discovery-by-capability\",\n      children: \"2. Tool Discovery by Capability\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"# Store tool metadata\\nkv.put_json(\\\"tool:sql-executor\\\", {\\n    \\\"name\\\": \\\"SQL Executor\\\",\\n    \\\"description\\\": \\\"Executes parameterized SQL queries\\\"\\n})\\n\\n# Agent searches for relevant tools\\ntools = kv.search(\\\"execute database queries\\\", top_k=3)\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h3, {\n      id: \"3-multi-agent-knowledge-sharing\",\n      children: \"3. Multi-Agent Knowledge Sharing\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"# Agent A discovers rate limit\\nagent_a.put_json(\\\"discovery:rate-limit\\\", {\\n    \\\"endpoint\\\": \\\"/api/users\\\",\\n    \\\"limit\\\": \\\"100 req/min\\\"\\n})\\n\\n# Agent B searches without knowing exact key\\nresults = agent_b.search(\\\"API rate limiting\\\", top_k=1)\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h3, {\n      id: \"4-conversation-context-retrieval\",\n      children: \"4. Conversation Context Retrieval\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"# Store conversation turns\\nkv.put_json(\\\"conv:turn:42\\\", {\\n    \\\"user\\\": \\\"What files are in the project?\\\",\\n    \\\"assistant\\\": \\\"[directory listing]\\\"\\n})\\n\\n# Retrieve relevant context\\ncontext = kv.search(\\\"explore project structure\\\", top_k=5)\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      id: \"xii-getting-started\",\n      children: \"XII. Getting Started\"\n    }), \"\\n\", _jsx(_components.h3, {\n      id: \"installation\",\n      children: \"Installation\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-bash\",\n        children: \"pip install semantic-kv\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h3, {\n      id: \"start-a-cluster\",\n      children: \"Start a Cluster\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"from semantic_kv import SemanticKVNode, DistributedSemanticKV\\n\\n# Start nodes (in separate processes)\\nnode1 = SemanticKVNode(location=\\\"grpc://0.0.0.0:8815\\\", node_id=\\\"node-1\\\")\\nnode2 = SemanticKVNode(location=\\\"grpc://0.0.0.0:8816\\\", node_id=\\\"node-2\\\")\\n\\n# Connect client\\nclient = DistributedSemanticKV([\\n    \\\"grpc://localhost:8815\\\",\\n    \\\"grpc://localhost:8816\\\"\\n])\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h3, {\n      id: \"basic-operations\",\n      children: \"Basic Operations\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"# Store data\\nclient.put(\\\"key1\\\", b\\\"value1\\\")\\nclient.put_json(\\\"user:123\\\", {\\\"name\\\": \\\"Alice\\\", \\\"role\\\": \\\"admin\\\"})\\n\\n# Exact retrieval\\nvalue = client.get(\\\"key1\\\")\\nuser = client.get_json(\\\"user:123\\\")\\n\\n# Semantic search\\nresults = client.search(\\\"find admin users\\\", top_k=5, threshold=0.7)\\nfor key, value, similarity, node in results:\\n    print(f\\\"Key: {key}, Score: {similarity:.2f}\\\")\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      id: \"xiii-conclusion\",\n      children: \"XIII. Conclusion\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Semantic Cache bridges the gap between traditional caching systems and modern AI requirements. The key architectural decisions:\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"Apache Arrow Flight\"\n        }), \" for high-performance RPC with zero-copy semantics\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"Arrow IPC format\"\n        }), \" for efficient persistence and cross-language compatibility\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"In-memory primary storage\"\n        }), \" with optional disk persistence\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"Consistent hashing\"\n        }), \" for deterministic key routing with minimal reshuffling\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"Scatter-gather pattern\"\n        }), \" for distributed semantic search\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"HNSW indexing\"\n        }), \" for sub-millisecond vector similarity search\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"This combination enables agentic AI systems to:\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"Find relevant past experiences by meaning\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Avoid redundant computations\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Share knowledge across agents naturally\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Scale horizontally with demand\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.hr, {}), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(_components.strong, {\n        children: \"Related Reading\"\n      }), \":\"]\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"https://arrow.apache.org/docs/format/Flight.html\",\n          children: \"Apache Arrow Flight\"\n        })\n      }), \"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"https://arxiv.org/abs/1603.09320\",\n          children: \"Hierarchical Navigable Small World (HNSW)\"\n        })\n      }), \"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"https://en.wikipedia.org/wiki/Consistent_hashing\",\n          children: \"Consistent Hashing\"\n        })\n      }), \"\\n\"]\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = {\n    ..._provideComponents(),\n    ...props.components\n  };\n  return MDXLayout ? _jsx(MDXLayout, {\n    ...props,\n    children: _jsx(_createMdxContent, {\n      ...props\n    })\n  }) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","frontmatter":{},"scope":{}},"id":"semantic-cache"},"__N_SSG":true},"page":"/blog/[id]","query":{"id":"semantic-cache"},"buildId":"07lGeU8PBalbsg9jjiHrK","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>